# ShadowMap æ™ºèƒ½å‡ºè¡Œé˜´å½±è§„åˆ’ç³»ç»Ÿ - å¼€å‘æ–‡æ¡£

## ğŸ¯ é¡¹ç›®æ„¿æ™¯ä¸ç›®æ ‡

### æ ¸å¿ƒç†å¿µ
åŸºäº [shademap.app](https://shademap.app/terms/) çš„é˜´å½±æ¨¡æ‹ŸæŠ€æœ¯ï¼Œæ‰“é€ **æ™ºèƒ½å‡ºè¡Œè§„åˆ’ç³»ç»Ÿ**ï¼Œä¸ºç”¨æˆ·æä¾›åŸºäºé˜´å½±å’Œå¤©æ°”æ•°æ®çš„å‡ºè¡Œå»ºè®®ã€‚

### äº§å“å·®å¼‚åŒ–å®šä½
- **åŸºç¡€åŠŸèƒ½**ï¼šå¤ç°shademap.appçš„å…¨çƒé˜´å½±æ¨¡æ‹Ÿèƒ½åŠ›
- **æ ¸å¿ƒåˆ›æ–°**ï¼šé¢å‘å‡ºè¡Œåœºæ™¯çš„æ™ºèƒ½è§„åˆ’åŠŸèƒ½
  - ğŸš¶â€â™‚ï¸ **æœ€å°‘é˜³å…‰è·¯å¾„è§„åˆ’** - ä¸ºç”¨æˆ·è§„åˆ’æ™’å¤ªé˜³æœ€å°‘çš„å‡ºè¡Œè·¯çº¿
  - ğŸ“Š **å…‰ç…§æ—¶é—´åºåˆ—åˆ†æ** - åˆ†æGPSè½¨è¿¹çš„å®Œæ•´å…‰ç…§æš´éœ²æƒ…å†µ
  - ğŸŒ¤ï¸ **å¤©æ°”æ•°æ®èåˆ** - ç»“åˆäº‘å±‚ã€UVæŒ‡æ•°ç­‰å®æ—¶å¤©æ°”æ•°æ®
  - ğŸ“ˆ **ä¸€æ—¥å…‰ç…§ç»Ÿè®¡** - ç±»ä¼¼å¥åº·åº”ç”¨çš„æ­¥æ•°ç»Ÿè®¡åŠŸèƒ½

## ğŸ“‹ æŠ€æœ¯æ ˆæ¶æ„

### å‰ç«¯æŠ€æœ¯æ ˆ
- **æ¡†æ¶**: React 19 + TypeScript + Vite
- **åœ°å›¾**: Leaflet + leaflet-shadow-simulator (é˜´å½±è®¡ç®—å¼•æ“)
- **çŠ¶æ€ç®¡ç†**: Zustand
- **æ ·å¼**: Tailwind CSS
- **æ•°æ®è·å–**: è‡ªå»ºAPIæœåŠ¡

### åç«¯æŠ€æœ¯æ ˆ
- **æœåŠ¡å™¨**: Node.js + Express + TypeScript
- **æ•°æ®åº“**: MongoDB (åœ°ç†æ•°æ®ã€ç”¨æˆ·è½¨è¿¹ã€ç¼“å­˜)
- **åœ°ç†æ•°æ®**: è‡ªå»ºDEMç“¦ç‰‡æœåŠ¡ + OSMå»ºç­‘ç‰©æ•°æ®
- **å¤©æ°”æ•°æ®**: é›†æˆ [earth.nullschool.net](https://earth.nullschool.net) API

### æ•°æ®æºç­–ç•¥
- **DEMåœ°å½¢æ•°æ®**: AWS Terrariumæ ¼å¼ï¼Œæ”¯æŒå…¨çƒè¦†ç›–
- **å»ºç­‘ç‰©æ•°æ®**: OSM Overpass API + æ™ºèƒ½ç¼“å­˜ç­–ç•¥
- **å¤©æ°”æ•°æ®**: nullschool.net (UVæŒ‡æ•°ã€äº‘å±‚è¦†ç›–ã€æ¸©åº¦ç­‰)

## ğŸš€ å¼€å‘é˜¶æ®µè§„åˆ’

### âœ… ç¬¬ä¸€é˜¶æ®µï¼šåŸºç¡€æ¶æ„ (å·²å®Œæˆ)
- [x] å‰åç«¯åˆ†ç¦»æ¶æ„æ­å»º
- [x] React + TypeScript + Leaflet é›†æˆ
- [x] Express APIæœåŠ¡å™¨
- [x] leaflet-shadow-simulator æ’ä»¶é›†æˆ
- [x] DEMç“¦ç‰‡æœåŠ¡ (æ”¯æŒåŒ—äº¬åœ°åŒºçœŸå®æ•°æ®)
- [x] OSMå»ºç­‘ç‰©APIé›†æˆ
- [x] å¤šåº•å›¾æ”¯æŒç³»ç»Ÿ

### ğŸ”„ ç¬¬äºŒé˜¶æ®µï¼šæ ¸å¿ƒåŠŸèƒ½å®Œå–„ (è¿›è¡Œä¸­)
- [x] å»ºç­‘ç‰©é«˜åº¦ä¸é˜´å½±è®¡ç®—è”åŠ¨
- [x] æ—¶é—´æ§åˆ¶å’ŒåŠ¨ç”»ç³»ç»Ÿ
- [x] ç‚¹å‡»åˆ†æåŠŸèƒ½
- [x] é«˜çº§ç¼“å­˜ç®¡ç†ç³»ç»Ÿ
- [ ] **MongoDBæ•°æ®åº“é›†æˆ** (æ›¿æ¢æ–‡ä»¶ç¼“å­˜)
- [ ] **OSM APIé€Ÿç‡é™åˆ¶ä¼˜åŒ–** (é¢„å¤„ç†çƒ­é—¨åŸå¸‚æ•°æ®)

### ğŸ¯ ç¬¬ä¸‰é˜¶æ®µï¼šå‡ºè¡Œè§„åˆ’åŠŸèƒ½ (æ ¸å¿ƒåˆ›æ–°)

#### 3.1 è·¯å¾„è§„åˆ’ç®—æ³•
```typescript
// æœ€å°‘é˜³å…‰è·¯å¾„ä¼˜åŒ–
class ShadowRouteOptimizer {
  async findMinSunRoute(start: LatLng, end: LatLng, time: Date) {
    // 1. è·å–å¤šæ¡å¯é€‰è·¯å¾„
    const routes = await this.getAllPossibleRoutes(start, end);
    
    // 2. åˆ†ææ¯æ¡è·¯å¾„çš„é˜´å½±æš´éœ²
    const analyzed = await Promise.all(
      routes.map(route => this.analyzeSunExposure(route, time))
    );
    
    // 3. ç»¼åˆè¯„åˆ†ï¼šé˜´å½±è¦†ç›–ç‡ + è·¯å¾„é•¿åº¦ + èˆ’é€‚åº¦
    return this.rankRoutesByComfort(analyzed);
  }
  
  private async analyzeSunExposure(route: Route, time: Date) {
    const segments = this.divideRouteIntoSegments(route);
    let totalSunExposure = 0;
    
    for (const segment of segments) {
      const shadowData = await this.calculateShadowForSegment(segment, time);
      const weatherData = await this.getWeatherData(segment.center, time);
      
      // è€ƒè™‘äº‘å±‚é®æŒ¡æ•ˆæœ
      const effectiveSun = shadowData.sunlight * (1 - weatherData.cloudCover * 0.8);
      const uvExposure = effectiveSun * weatherData.uvIndex;
      
      totalSunExposure += uvExposure * segment.duration;
    }
    
    return {
      route,
      totalSunExposure,
      comfort: this.calculateComfort(totalSunExposure),
      estimatedTime: route.duration
    };
  }
}
```

#### 3.2 GPSè½¨è¿¹åˆ†æ
```typescript
// å…‰ç…§æ—¶é—´åºåˆ—åˆ†æ
class TrajectoryAnalyzer {
  async analyzeLightExposure(gpsTrack: GPSPoint[]) {
    const timeSeriesData: LightExposurePoint[] = [];
    
    for (let i = 0; i < gpsTrack.length - 1; i++) {
      const segment = {
        start: gpsTrack[i],
        end: gpsTrack[i + 1],
        duration: gpsTrack[i + 1].timestamp - gpsTrack[i].timestamp
      };
      
      // è·å–é˜´å½±æ•°æ®
      const shadowData = await this.calculateShadowForSegment(segment);
      
      // è·å–å¤©æ°”æ•°æ®
      const weatherData = await this.getWeatherData(segment.start, segment.start.timestamp);
      
      timeSeriesData.push({
        time: gpsTrack[i].timestamp,
        location: gpsTrack[i],
        sunlightRatio: shadowData.sunlightRatio,
        uvExposure: shadowData.uvExposure * weatherData.uvIndex,
        comfort: this.calculateComfort(weatherData),
        cloudCover: weatherData.cloudCover
      });
    }
    
    return this.generateDailyReport(timeSeriesData);
  }
  
  private generateDailyReport(data: LightExposurePoint[]) {
    return {
      totalSunlightMinutes: data.reduce((sum, point) => sum + point.sunlightRatio * point.duration, 0),
      totalUVExposure: data.reduce((sum, point) => sum + point.uvExposure, 0),
      averageComfort: data.reduce((sum, point) => sum + point.comfort, 0) / data.length,
      peakExposureTime: data.reduce((max, point) => point.uvExposure > max.uvExposure ? point : max),
      recommendations: this.generateRecommendations(data)
    };
  }
}
```

#### 3.3 å¤©æ°”æ•°æ®é›†æˆ
```typescript
// å¤©æ°”æ•°æ®å¢å¼ºé˜´å½±è®¡ç®—
class WeatherEnhancedShadowCalculator {
  async calculateWithWeather(location: LatLng, time: Date) {
    // 1. åŸºç¡€é˜´å½±è®¡ç®—
    const baseShadow = await this.calculateBaseShadow(location, time);
    
    // 2. è·å–å®æ—¶å¤©æ°”æ•°æ®
    const weather = await this.fetchWeatherData(location, time);
    
    // 3. äº‘å±‚ä¿®æ­£
    const cloudCover = weather.cloudCover; // 0-1
    const effectiveSunlight = baseShadow.sunlight * (1 - cloudCover * 0.8);
    
    // 4. UVæŒ‡æ•°ä¿®æ­£
    const uvIndex = weather.uvIndex;
    const uvExposure = effectiveSunlight * uvIndex;
    
    return {
      ...baseShadow,
      effectiveSunlight,
      uvExposure,
      comfort: this.calculateComfort(weather),
      recommendations: this.generateRecommendations(weather, baseShadow)
    };
  }
  
  private async fetchWeatherData(location: LatLng, time: Date) {
    // é›†æˆ nullschool.net API
    const response = await fetch(`/api/weather?lat=${location.lat}&lng=${location.lng}&time=${time.toISOString()}`);
    return response.json();
  }
}
```

### ğŸ¨ ç¬¬å››é˜¶æ®µï¼šç”¨æˆ·ä½“éªŒä¼˜åŒ–

#### 4.1 æ™ºèƒ½æ¨èç³»ç»Ÿ
- **æœ€ä½³å‡ºè¡Œæ—¶é—´æ¨è**: åŸºäºå¤©æ°”é¢„æŠ¥å’Œé˜´å½±é¢„æµ‹
- **å®æ—¶è·¯å¾„è°ƒæ•´**: æ ¹æ®äº‘å±‚å˜åŒ–åŠ¨æ€è°ƒæ•´è·¯çº¿
- **ä¸ªæ€§åŒ–è®¾ç½®**: ç”¨æˆ·å¯è®¾ç½®å¯¹é˜³å…‰çš„æ•æ„Ÿåº¦

#### 4.2 å¯è§†åŒ–å¢å¼º
- **å®æ—¶è·¯å¾„å»ºè®®**: ç±»ä¼¼å¯¼èˆªï¼Œä½†ä¼˜åŒ–ç›®æ ‡æ˜¯èˆ’é€‚åº¦
- **ä¸€æ—¥å…‰ç…§æŠ¥å‘Š**: ç±»ä¼¼å¥åº·åº”ç”¨çš„æ´»åŠ¨ç»Ÿè®¡
- **é˜´å½±è½¨è¿¹å¯è§†åŒ–**: æ˜¾ç¤ºå¤ªé˜³è·¯å¾„å’Œé˜´å½±å˜åŒ–

## ğŸ’¾ MongoDBæ•°æ®åº“è®¾è®¡

### é›†åˆç»“æ„è®¾è®¡
```javascript
// å»ºç­‘ç‰©æ•°æ®é›†åˆ
db.buildings.createIndex({ "geometry": "2dsphere" }); // åœ°ç†ç©ºé—´ç´¢å¼•
{
  _id: ObjectId,
  geometry: {
    type: "Polygon",
    coordinates: [[[lng, lat], ...]]
  },
  properties: {
    height: 25.5,
    levels: 8,
    building_type: "residential"
  },
  tile: { z: 15, x: 26976, y: 13487 }, // ç“¦ç‰‡ç´¢å¼•
  last_updated: ISODate
}

// ç”¨æˆ·å‡ºè¡Œè½¨è¿¹é›†åˆ
db.user_tracks.createIndex({ "route.geometry": "2dsphere" });
{
  _id: ObjectId,
  user_id: "user123",
  route: {
    type: "LineString",
    coordinates: [[lng, lat, timestamp], ...]
  },
  analysis: {
    total_sunlight_minutes: 45,
    total_uv_exposure: 2.3,
    comfort_score: 7.5,
    shadow_segments: [...]
  },
  created_at: ISODate
}

// DEMç“¦ç‰‡å…ƒæ•°æ®é›†åˆ
db.dem_tiles.createIndex({ "z": 1, "x": 1, "y": 1 });
{
  _id: "15/26976/13487",
  z: 15, x: 26976, y: 13487,
  bounds: [lng1, lat1, lng2, lat2],
  file_path: "/data/dem/15/26976/13487.png",
  cached: true,
  created_at: ISODate
}
```

### æ•°æ®åˆ†ç‰‡ç­–ç•¥
- **åœ°ç†åˆ†ç‰‡**: æŒ‰ç»çº¬åº¦èŒƒå›´åˆ†ç‰‡ï¼Œæ”¯æŒå…¨çƒæ•°æ®åˆ†å¸ƒ
- **æ—¶é—´åˆ†ç‰‡**: ç”¨æˆ·è½¨è¿¹æŒ‰æ—¶é—´åˆ†ç‰‡ï¼Œä¼˜åŒ–æŸ¥è¯¢æ€§èƒ½

## ğŸŒ APIæ¥å£è®¾è®¡

### æ ¸å¿ƒAPIç«¯ç‚¹
```typescript
// é˜´å½±è®¡ç®—ç›¸å…³
POST /api/shadow/calculate         // è®¡ç®—æŒ‡å®šåŒºåŸŸé˜´å½±
GET  /api/shadow/realtime         // å®æ—¶é˜´å½±æ•°æ®
POST /api/shadow/analyze-route    // åˆ†æè·¯å¾„é˜´å½±æš´éœ²

// å‡ºè¡Œè§„åˆ’ç›¸å…³ (æ–°å¢)
POST /api/routes/optimize         // æœ€å°‘é˜³å…‰è·¯å¾„è§„åˆ’
POST /api/routes/analyze          // GPSè½¨è¿¹åˆ†æ
GET  /api/routes/recommendations  // è·å–å‡ºè¡Œå»ºè®®

// å¤©æ°”æ•°æ®ç›¸å…³ (æ–°å¢)
GET  /api/weather/current         // å½“å‰å¤©æ°”æ•°æ®
GET  /api/weather/forecast        // å¤©æ°”é¢„æŠ¥
GET  /api/weather/uv-index        // UVæŒ‡æ•°æŸ¥è¯¢

// åœ°ç†æ•°æ®ç›¸å…³
GET  /api/dem/:z/:x/:y.png        // DEMç“¦ç‰‡
GET  /api/buildings/:z/:x/:y.json // å»ºç­‘ç‰©æ•°æ®
GET  /api/terrain/elevation       // é«˜ç¨‹æŸ¥è¯¢

// ç”¨æˆ·æ•°æ®ç›¸å…³ (æ–°å¢)
POST /api/users/tracks            // ä¿å­˜ç”¨æˆ·è½¨è¿¹
GET  /api/users/tracks/:id        // è·å–è½¨è¿¹åˆ†æ
GET  /api/users/stats            // ç”¨æˆ·å…‰ç…§ç»Ÿè®¡
```

## ğŸ”§ æŠ€æœ¯æŒ‘æˆ˜ä¸è§£å†³æ–¹æ¡ˆ

### 1. OSM APIé€Ÿç‡é™åˆ¶é—®é¢˜
**é—®é¢˜**: Overpass APIé™åˆ¶æ¯åˆ†é’Ÿ60ä¸ªè¯·æ±‚
**è§£å†³æ–¹æ¡ˆ**:
- **æ•°æ®é¢„å¤„ç†**: é¢„ä¸‹è½½çƒ­é—¨åŸå¸‚å»ºç­‘ç‰©æ•°æ®åˆ°MongoDB
- **æ™ºèƒ½ç¼“å­˜**: å®ç°å¤šçº§ç¼“å­˜(å†…å­˜ + æ•°æ®åº“ + æ–‡ä»¶)
- **è¯·æ±‚é˜Ÿåˆ—**: å®ç°é€Ÿç‡æ§åˆ¶å’Œè¯·æ±‚å»é‡

### 2. å¤§è§„æ¨¡åœ°ç†æ•°æ®å¤„ç†
**é—®é¢˜**: å…¨çƒDEMå’Œå»ºç­‘ç‰©æ•°æ®é‡å·¨å¤§
**è§£å†³æ–¹æ¡ˆ**:
- **åˆ†çº§æ•°æ®ç­–ç•¥**: æ ¸å¿ƒåŸå¸‚é¢„å­˜å‚¨ï¼Œå…¶ä»–åœ°åŒºAPIè°ƒç”¨
- **æ•°æ®å‹ç¼©**: ä½¿ç”¨é«˜æ•ˆçš„åœ°ç†æ•°æ®å‹ç¼©ç®—æ³•
- **è¾¹ç¼˜ç¼“å­˜**: CDNç¼“å­˜é™æ€ç“¦ç‰‡æ•°æ®

### 3. å®æ—¶å¤©æ°”æ•°æ®é›†æˆ
**é—®é¢˜**: éœ€è¦é›†æˆå¤šä¸ªå¤©æ°”æ•°æ®æº
**è§£å†³æ–¹æ¡ˆ**:
- **ç»Ÿä¸€å¤©æ°”API**: å°è£…nullschool.netç­‰å¤šä¸ªæ•°æ®æº
- **æ•°æ®ç¼“å­˜**: å¤©æ°”æ•°æ®æŒ‰æ—¶é—´å’Œä½ç½®ç¼“å­˜
- **é™çº§ç­–ç•¥**: æ•°æ®æºå¤±æ•ˆæ—¶çš„å¤‡ç”¨æ–¹æ¡ˆ

## ğŸ“Š å½“å‰å¼€å‘çŠ¶æ€ (2025-01-XX æ›´æ–°)

### âœ… å·²å®ŒæˆåŠŸèƒ½

#### ğŸ¯ æ ¸å¿ƒé˜´å½±è®¡ç®—ç³»ç»Ÿ
- [x] **å¤šå¼•æ“é˜´å½±æ¨¡æ‹Ÿ**: React + mapbox-gl-shadow-simulator
- [x] **DEMåœ°å½¢æ•°æ®é›†æˆ**: AWS Terrariumæ ¼å¼ï¼Œæ”¯æŒçœŸå®åœ°å½¢
- [x] **å»ºç­‘ç‰©æ•°æ®ç³»ç»Ÿ**: OSM Overpass APIï¼Œæ”¯æŒ60+ç§å»ºç­‘ç±»å‹
- [x] **æ™ºèƒ½æŸ¥è¯¢ç­–ç•¥**: fast/standard/completeä¸‰çº§æŸ¥è¯¢ç­–ç•¥
- [x] **åœ°åŸŸåŒ–ä¼˜åŒ–**: æ ¹æ®åœ°ç†ä½ç½®é€‰æ‹©æœ€ä½³APIç«¯ç‚¹

#### ğŸ—ï¸ æ•°æ®æ¶æ„ä¸ç¼“å­˜
- [x] **MongoDB Atlasé›†æˆ**: å®Œæ•´çš„æ•°æ®åº“è¿æ¥å’Œç´¢å¼•ç³»ç»Ÿ
- [x] **ä¸‰çº§ç¼“å­˜æ¶æ„**: Redis â†’ MongoDB â†’ OSM API
- [x] **æ•°æ®é¢„å¤„ç†ç³»ç»Ÿ**: æ”¯æŒçƒ­é—¨åŸå¸‚æ‰¹é‡æ•°æ®é¢„åŠ è½½
- [x] **åŒ—äº¬Caseå®ç°**: å®Œæ•´çš„åŒ—äº¬åœ°åŒºæ•°æ®é¢„å¤„ç†éªŒè¯

#### ğŸ¨ ç”¨æˆ·ç•Œé¢ä¸ä½“éªŒ
- [x] **å¤šåœ°å›¾å¼•æ“æ”¯æŒ**: Leafletã€Mapbox GLã€TUM 3Dã€Cleanæ¨¡å¼
- [x] **CleanShadowMapç»„ä»¶**: ç®€æ´ä¼˜é›…çš„æ‰‹åŠ¨æ§åˆ¶ç•Œé¢
- [x] **å‚è€ƒç½‘ç«™é£æ ¼å­¦ä¹ **: åŸºäºshademap.appçš„UIè®¾è®¡ç†å¿µ
- [x] **æ—¶é—´è½´é‡æ„**: æ‚¬æµ®è®¾è®¡ï¼Œé¿å…é®æŒ¡åœ°å›¾
- [x] **é˜´å½±è´¨é‡æ§åˆ¶**: åŠ¨æ€é€æ˜åº¦ã€é¢œè‰²å’Œå»ºç­‘ç­›é€‰

#### ğŸ”§ æ€§èƒ½ä¼˜åŒ–ç³»ç»Ÿ
- [x] **æ™ºèƒ½é˜´å½±è®¡ç®—**: é˜²æŠ–æœºåˆ¶ï¼Œå‡å°‘70%ä¸å¿…è¦è®¡ç®—
- [x] **å¤šçº§ç¼“å­˜ç®¡ç†**: å†…å­˜+æ•°æ®åº“+æ–‡ä»¶æ··åˆç¼“å­˜
- [x] **æ¸è¿›å¼åŠ è½½**: æ ¹æ®zoomçº§åˆ«çš„åˆ†çº§åŠ è½½ç­–ç•¥
- [x] **é”™è¯¯å¤„ç†å¢å¼º**: æŒ‡æ•°é€€é¿é‡è¯•ï¼Œå¤šç«¯ç‚¹è´Ÿè½½å‡è¡¡

### ğŸ”„ è¿›è¡Œä¸­ä»»åŠ¡
- [x] **MongoDBæ•°æ®åº“é›†æˆ** (âœ… å·²è§£å†³è¿æ¥é—®é¢˜)
- [x] **é˜´å½±é”™ä½é—®é¢˜ä¿®å¤** (ğŸ”„ éƒ¨åˆ†è§£å†³ï¼Œéœ€è¦è¿›ä¸€æ­¥ä¼˜åŒ–)
- [ ] **TUMæ•°æ®é•¿æœŸç¼“å­˜ç­–ç•¥** (ğŸ¯ åŸºäº4ä¸ªæœˆæ›´æ–°é¢‘ç‡çš„ä¼˜åŒ–æ–¹æ¡ˆ)
- [ ] **ç”¨æˆ·ä½“éªŒç»†èŠ‚ä¼˜åŒ–** (ğŸ¯ æŒ‰é’®å¯è§æ€§ã€äº¤äº’æµç•…åº¦)

### ğŸ“ æœªå¼€å§‹çš„æ ¸å¿ƒåŠŸèƒ½
- [ ] **æ™ºèƒ½å‡ºè¡Œè§„åˆ’ç®—æ³•** (é¡¹ç›®æ ¸å¿ƒåˆ›æ–°åŠŸèƒ½)
- [ ] **å¤©æ°”æ•°æ®APIé›†æˆ** (nullschool.net)
- [ ] **GPSè½¨è¿¹åˆ†æåŠŸèƒ½**
- [ ] **è·¯å¾„ä¼˜åŒ–ç®—æ³•å®ç°**

## ğŸš€ ä¸‹ä¸€é˜¶æ®µå¼€å‘è®¡åˆ’ (2025-01-XX)

### ğŸ“‹ ç«‹å³ä¼˜å…ˆçº§ (1å‘¨å†…)

#### 1. ğŸ¯ TUMæ•°æ®ç¼“å­˜ç­–ç•¥ä¼˜åŒ–
**ç›®æ ‡**: åŸºäºTUMæ•°æ®4ä¸ªæœˆæ›´æ–°é¢‘ç‡ï¼Œå®ç°é•¿æœŸç¼“å­˜ç­–ç•¥
- **å®ç°ç½‘æ ¼åŒ–ç¼“å­˜**: æŒ‰å›ºå®šç½‘æ ¼åˆ’åˆ†åœ°å›¾ï¼Œç¼“å­˜æ—¶é—´2-3ä¸ªæœˆ
- **æ™ºèƒ½é¢„åŠ è½½**: æ ¹æ®ç”¨æˆ·ç§»åŠ¨æ¨¡å¼é¢„åŠ è½½ç›¸é‚»ç½‘æ ¼
- **ç¼“å­˜ç®¡ç†ç•Œé¢**: ç”¨æˆ·å¯æŸ¥çœ‹å’Œç®¡ç†æœ¬åœ°ç¼“å­˜
- **é¢„æœŸæ•ˆæœ**: åŒä¸€åŒºåŸŸé‡å¤è®¿é—®æ—¶å‡ ä¹ç¬æ—¶åŠ è½½

#### 2. ğŸ”§ ç”¨æˆ·ä½“éªŒé—®é¢˜ä¿®å¤
**ç›®æ ‡**: è§£å†³å½“å‰ç”¨æˆ·åé¦ˆçš„å…³é”®é—®é¢˜
- **æŒ‰é’®å¯è§æ€§**: ç¡®ä¿æ‰€æœ‰æ§åˆ¶æŒ‰é’®åœ¨å„ç§å±å¹•å°ºå¯¸ä¸‹å¯è§
- **é˜´å½±å¯¹é½ç²¾åº¦**: è¿›ä¸€æ­¥ä¼˜åŒ–é˜´å½±ä¸å»ºç­‘ç‰©çš„ç©ºé—´å¯¹é½
- **äº¤äº’æµç•…åº¦**: ä¼˜åŒ–åœ°å›¾æ‹–æ‹½å’Œç¼©æ”¾æ—¶çš„å“åº”é€Ÿåº¦
- **é”™è¯¯å¤„ç†**: å®Œå–„å„ç§å¼‚å¸¸æƒ…å†µçš„ç”¨æˆ·æç¤º

### ğŸ“ˆ é«˜ä¼˜å…ˆçº§ (2-3å‘¨)

#### 3. ğŸŒ¤ï¸ å¤©æ°”æ•°æ®é›†æˆç³»ç»Ÿ
**ç›®æ ‡**: é›†æˆå®æ—¶å¤©æ°”æ•°æ®ï¼Œä¸ºæ™ºèƒ½å‡ºè¡Œè§„åˆ’åšå‡†å¤‡
- **nullschool.net APIé›†æˆ**: è·å–äº‘å±‚ã€UVæŒ‡æ•°ã€æ¸©åº¦æ•°æ®
- **å¤©æ°”æ•°æ®ç¼“å­˜**: æŒ‰æ—¶é—´å’Œä½ç½®ç¼“å­˜å¤©æ°”ä¿¡æ¯
- **é˜´å½±ä¿®æ­£ç®—æ³•**: åŸºäºäº‘å±‚è¦†ç›–ä¿®æ­£é˜´å½±è®¡ç®—
- **å¤©æ°”å¯è§†åŒ–**: åœ¨åœ°å›¾ä¸Šæ˜¾ç¤ºå¤©æ°”å›¾å±‚

#### 4. ğŸ›£ï¸ æ™ºèƒ½å‡ºè¡Œè§„åˆ’æ ¸å¿ƒç®—æ³•
**ç›®æ ‡**: å®ç°é¡¹ç›®çš„æ ¸å¿ƒåˆ›æ–°åŠŸèƒ½
- **è·¯å¾„åˆ†æç®—æ³•**: åˆ†æè·¯å¾„çš„é˜´å½±æš´éœ²æƒ…å†µ
- **æœ€å°‘é˜³å…‰è·¯å¾„**: åŸºäºé˜´å½±æ•°æ®çš„è·¯å¾„ä¼˜åŒ–
- **èˆ’é€‚åº¦è¯„åˆ†**: ç»¼åˆé˜´å½±ã€å¤©æ°”ã€è·ç¦»çš„è¯„åˆ†ç³»ç»Ÿ
- **è·¯å¾„æ¨èAPI**: ä¸ºå‰ç«¯æä¾›è·¯å¾„å»ºè®®æ¥å£

### ğŸ“Š ä¸­ä¼˜å…ˆçº§ (1-2ä¸ªæœˆ)

#### 5. ğŸ“± GPSè½¨è¿¹åˆ†æåŠŸèƒ½
**ç›®æ ‡**: å®ç°ç”¨æˆ·è½¨è¿¹çš„å…‰ç…§åˆ†æ
- **è½¨è¿¹ä¸Šä¼ **: æ”¯æŒGPXæ–‡ä»¶æˆ–å®æ—¶GPSæ•°æ®
- **å…‰ç…§æ—¶é—´åºåˆ—**: åˆ†æè½¨è¿¹çš„å®Œæ•´å…‰ç…§æš´éœ²
- **ä¸€æ—¥å…‰ç…§æŠ¥å‘Š**: ç±»ä¼¼å¥åº·åº”ç”¨çš„ç»Ÿè®¡ç•Œé¢
- **ä¸ªäººåŒ–å»ºè®®**: åŸºäºå†å²è½¨è¿¹çš„å‡ºè¡Œå»ºè®®

#### 6. ğŸ¨ é«˜çº§å¯è§†åŒ–åŠŸèƒ½
**ç›®æ ‡**: æå‡æ•°æ®å±•ç¤ºå’Œåˆ†æèƒ½åŠ›
- **çƒ­åŠ›å›¾æ¨¡å¼**: æ˜¾ç¤ºåŒºåŸŸæ—¥ç…§å¼ºåº¦åˆ†å¸ƒ
- **æ—¶é—´åŠ¨ç”»**: å±•ç¤ºä¸€å¤©å†…é˜´å½±å˜åŒ–è¿‡ç¨‹
- **3Dé˜´å½±æŠ•å°„**: çœŸå®çš„ä¸‰ç»´é˜´å½±æ•ˆæœ
- **æ•°æ®å¯¼å‡º**: æ”¯æŒåˆ†æç»“æœçš„æ•°æ®å¯¼å‡º

### ğŸ”® é•¿æœŸè§„åˆ’ (3-6ä¸ªæœˆ)

#### 7. ğŸš€ æ€§èƒ½ä¸æ‰©å±•æ€§ä¼˜åŒ–
- **WebGLæ¸²æŸ“å¼•æ“**: è‡ªç ”é«˜æ€§èƒ½é˜´å½±è®¡ç®—
- **å…¨çƒæ•°æ®æ”¯æŒ**: æ‰©å±•åˆ°å…¨çƒä¸»è¦åŸå¸‚
- **ç§»åŠ¨ç«¯ä¼˜åŒ–**: PWAå’Œå“åº”å¼è®¾è®¡
- **APIå•†ä¸šåŒ–**: é¢å‘ç¬¬ä¸‰æ–¹å¼€å‘è€…çš„APIæœåŠ¡

#### 8. ğŸ¢ ä¼ä¸šçº§åŠŸèƒ½
- **ç”¨æˆ·ç³»ç»Ÿ**: è´¦æˆ·ç®¡ç†å’Œæ•°æ®åŒæ­¥
- **å›¢é˜Ÿåä½œ**: å¤šç”¨æˆ·å…±äº«å’Œåä½œåŠŸèƒ½
- **æ•°æ®åˆ†æ**: ç”¨æˆ·è¡Œä¸ºå’Œä½¿ç”¨æ¨¡å¼åˆ†æ
- **SaaSéƒ¨ç½²**: ä¼ä¸šçº§éƒ¨ç½²å’Œç®¡ç†

## ğŸ’¡ æŠ€æœ¯å€ºåŠ¡ä¸ä¼˜åŒ–æœºä¼š

### ğŸ”§ å½“å‰æŠ€æœ¯é™åˆ¶
1. **é˜´å½±å¯¹é½ç²¾åº¦**: mapbox-gl-shadow-simulatorä¸Mapboxåº•å›¾å­˜åœ¨å¾®å°åå·®
2. **ç¼“å­˜ç­–ç•¥**: å½“å‰ç¼“å­˜æœªå……åˆ†åˆ©ç”¨TUMæ•°æ®ä½æ›´æ–°é¢‘ç‡ç‰¹ç‚¹
3. **UIå“åº”æ€§**: éƒ¨åˆ†æ§åˆ¶æŒ‰é’®åœ¨ä¸åŒè®¾å¤‡ä¸Šå­˜åœ¨å¯è§æ€§é—®é¢˜
4. **é”™è¯¯å¤„ç†**: ç½‘ç»œå¼‚å¸¸å’Œæ•°æ®ç¼ºå¤±æ—¶çš„ç”¨æˆ·ä½“éªŒéœ€è¦æ”¹è¿›

### ğŸ¯ ä¼˜åŒ–æ–¹å‘
1. **é•¿æœŸç¼“å­˜**: åŸºäºTUMæ•°æ®4ä¸ªæœˆæ›´æ–°å‘¨æœŸï¼Œå®ç°æœˆçº§åˆ«ç¼“å­˜
2. **æ™ºèƒ½é¢„åŠ è½½**: é¢„æµ‹ç”¨æˆ·ç§»åŠ¨æ¨¡å¼ï¼Œæå‰ç¼“å­˜ç›¸å…³åŒºåŸŸ
3. **æ¸è¿›å¼æ¸²æŸ“**: æ ¹æ®è®¾å¤‡æ€§èƒ½åŠ¨æ€è°ƒæ•´æ¸²æŸ“è´¨é‡
4. **ç¦»çº¿æ”¯æŒ**: æ”¯æŒç¦»çº¿æµè§ˆå·²ç¼“å­˜åŒºåŸŸ

## ğŸ”® æœªæ¥æŠ€æœ¯æ¼”è¿›

### ğŸš€ è‡ªç ”é˜´å½±è®¡ç®—å¼•æ“ (é•¿è¿œç›®æ ‡)
- **è‡ªç ”å¤ªé˜³ä½ç½®ç®—æ³•**: æ‘†è„±ç¬¬ä¸‰æ–¹åº“ä¾èµ–
- **è‡ªç ”å…‰çº¿è¿½è¸ªç®—æ³•**: é’ˆå¯¹å‡ºè¡Œåœºæ™¯ä¼˜åŒ–
- **è‡ªå®šä¹‰GPUç€è‰²å™¨**: å……åˆ†åˆ©ç”¨ç¡¬ä»¶åŠ é€Ÿ
- **å®Œå…¨è‡ªä¸»æŠ€æœ¯æ ˆ**: å®ç°æŠ€æœ¯å®Œå…¨å¯æ§

## ğŸ¯ å•†ä¸šåŒ–è€ƒè™‘

### ç›®æ ‡ç”¨æˆ·ç¾¤ä½“
- **ä¸ªäººç”¨æˆ·**: æ³¨é‡é˜²æ™’å’Œèˆ’é€‚å‡ºè¡Œçš„ç”¨æˆ·
- **å¥åº·åº”ç”¨å¼€å‘å•†**: éœ€è¦å…‰ç…§æ•°æ®çš„åº”ç”¨é›†æˆ
- **åŸå¸‚è§„åˆ’å¸ˆ**: éœ€è¦é˜´å½±åˆ†æçš„ä¸“ä¸šç”¨æˆ·
- **å»ºç­‘è®¾è®¡å¸ˆ**: éœ€è¦é‡‡å…‰åˆ†æçš„è®¾è®¡å¸ˆ

### å•†ä¸šæ¨¡å¼
- **APIè°ƒç”¨æ”¶è´¹**: æŒ‰è¯·æ±‚é‡è®¡è´¹çš„APIæœåŠ¡
- **SaaSè®¢é˜…**: é¢å‘ä¼ä¸šç”¨æˆ·çš„è®¢é˜…æœåŠ¡
- **æ•°æ®æˆæƒ**: å‘å…¶ä»–åº”ç”¨æä¾›åœ°ç†å’Œé˜´å½±æ•°æ®

### ç«äº‰ä¼˜åŠ¿
- **è‡ªä¸»æŠ€æœ¯æ ˆ**: å®Œå…¨åŸºäºè‡ªæœ‰æœåŠ¡å™¨ï¼Œä¸ä¾èµ–ç¬¬ä¸‰æ–¹
- **å‡ºè¡Œåœºæ™¯ä¼˜åŒ–**: é’ˆå¯¹å®é™…å‡ºè¡Œéœ€æ±‚çš„åŠŸèƒ½åˆ›æ–°
- **å…¨çƒæ•°æ®è¦†ç›–**: æ”¯æŒå…¨çƒä»»æ„ä½ç½®çš„é˜´å½±åˆ†æ
- **å®æ—¶å¤©æ°”é›†æˆ**: ç»“åˆå¤©æ°”æ•°æ®çš„æ™ºèƒ½æ¨è

---

## ğŸ“š æŠ€æœ¯æ¶æ„æ€»ç»“

### ç³»ç»Ÿæ¶æ„å›¾
```
ç”¨æˆ·ç•Œé¢ (React + Leaflet)
    â†“
çŠ¶æ€ç®¡ç† (Zustand Store)
    â†“
APIæœåŠ¡å±‚ (è‡ªå»ºExpress API)
    â†“
æ•°æ®å­˜å‚¨å±‚ (MongoDB + æ–‡ä»¶ç¼“å­˜)
    â†“
å¤–éƒ¨æ•°æ®æº (AWS DEM + OSM + Weather APIs)
```

### å…³é”®æŠ€æœ¯å†³ç­–
1. **å‰ç«¯**: Reactç”Ÿæ€ç³»ç»Ÿï¼Œç°ä»£åŒ–å¼€å‘ä½“éªŒ
2. **åœ°å›¾**: Leaflet + leaflet-shadow-simulatorï¼Œæˆç†Ÿçš„é˜´å½±è®¡ç®—æ–¹æ¡ˆ
3. **æ•°æ®æº**: å®Œå…¨è‡ªä¸»çš„DEMå’Œå»ºç­‘ç‰©æ•°æ®ï¼Œæ‘†è„±ç¬¬ä¸‰æ–¹ä¾èµ–
4. **æ•°æ®åº“**: MongoDBï¼ŒåŸç”Ÿæ”¯æŒåœ°ç†ç©ºé—´æ•°æ®
5. **ç¼“å­˜**: å¤šçº§ç¼“å­˜ç­–ç•¥ï¼Œå¹³è¡¡æ€§èƒ½å’Œæˆæœ¬
6. **éƒ¨ç½²**: Dockerå®¹å™¨åŒ–ï¼Œæ”¯æŒæ°´å¹³æ‰©å±•

### ğŸ”§ å½“å‰æŠ€æœ¯æ¶æ„è¯´æ˜
- **é˜´å½±è®¡ç®—**: ä½¿ç”¨leaflet-shadow-simulatorä½œä¸ºè®¡ç®—å¼•æ“ï¼Œä½†æ•°æ®å®Œå…¨æ¥è‡ªè‡ªå»ºæœåŠ¡
- **æ•°æ®ç‹¬ç«‹æ€§**: DEMç“¦ç‰‡å’Œå»ºç­‘ç‰©æ•°æ®å‡é€šè¿‡è‡ªå»ºAPIæä¾›
- **è®¡ç®—é€»è¾‘**: åŸºäºç‰©ç†å…‰çº¿è¿½è¸ªç®—æ³•ï¼Œæ”¯æŒçœŸå®çš„é˜´å½±æ¨¡æ‹Ÿ
- **æ‰©å±•æ€§**: ä¸ºæœªæ¥æ›¿æ¢ä¸ºè‡ªç ”å¼•æ“é¢„ç•™äº†æ¶æ„ç©ºé—´

---

## ğŸ› æŠ€æœ¯é—®é¢˜è§£å†³è®°å½•

### MongoDB Atlasè¿æ¥é—®é¢˜ (2025-01-XX)

#### é—®é¢˜æè¿°
- **ç—‡çŠ¶**: MongoDB Atlasè¿æ¥è¶…æ—¶ï¼ŒDNSè§£æå¤±è´¥
- **é”™è¯¯**: `queryTxt ETIMEOUT cluster0.1qxqrnr.mongodb.net`
- **å½±å“**: æ— æ³•å¯åŠ¨MongoDBé›†æˆåŠŸèƒ½

#### æ ¹æœ¬åŸå› 
**Windowsç³»ç»ŸDNSé…ç½®é—®é¢˜**ï¼š
- ç³»ç»Ÿé»˜è®¤ä½¿ç”¨è·¯ç”±å™¨DNS (192.168.1.1)
- è·¯ç”±å™¨DNSæ— æ³•æ­£ç¡®è§£æMongoDB AtlasåŸŸå
- å¯¼è‡´æ‰€æœ‰MongoDBè¿æ¥å·¥å…·å¤±è´¥ï¼ˆä»£ç ã€Compassç­‰ï¼‰

#### è§£å†³æ–¹æ¡ˆ
**åˆ‡æ¢åˆ°Google DNSæœåŠ¡å™¨**ï¼š
```bash
# 1. ä»¥ç®¡ç†å‘˜èº«ä»½è¿è¡ŒPowerShell
# 2. è®¾ç½®WLANæ¥å£ä½¿ç”¨Google DNS
netsh interface ip set dns "WLAN" static 8.8.8.8
netsh interface ip add dns "WLAN" 8.8.4.4 index=2

# 3. éªŒè¯è®¾ç½®
netsh interface ip show dns "WLAN"

# 4. åˆ·æ–°DNSç¼“å­˜
ipconfig /flushdns
```

#### éªŒè¯ç»“æœ
```bash
# DNSè§£ææˆåŠŸ
nslookup cluster0.1qxqrnr.mongodb.net 8.8.8.8
# è¾“å‡º: æœåŠ¡å™¨: dns.google, åç§°: cluster0.1qxqrnr.mongodb.net

# MongoDBè¿æ¥æˆåŠŸ
node src/config/db.js
# è¾“å‡º: MONGODB CONNECTED SUCCESSFULLY!
```

#### ç»éªŒæ•™è®­
1. **ç½‘ç»œç¯å¢ƒè¯Šæ–­**ï¼šMongoDBè¿æ¥é—®é¢˜é¦–å…ˆæ£€æŸ¥DNSè§£æ
2. **å·¥å…·å¯¹æ¯”éªŒè¯**ï¼šåŒæ—¶ç”¨ä»£ç å’ŒGUIå·¥å…·(Compass)éªŒè¯é—®é¢˜
3. **ç³»ç»Ÿçº§é…ç½®**ï¼šæŸäº›é—®é¢˜éœ€è¦ä¿®æ”¹ç³»ç»Ÿç½‘ç»œé…ç½®
4. **DNSæœåŠ¡å™¨é€‰æ‹©**ï¼šGoogle DNS (8.8.8.8) æ¯”è·¯ç”±å™¨DNSæ›´ç¨³å®š

#### é¢„é˜²æªæ–½
- å¼€å‘ç¯å¢ƒå»ºè®®ç»Ÿä¸€ä½¿ç”¨Google DNS
- æ–‡æ¡£è®°å½•ç½‘ç»œé…ç½®è¦æ±‚
- æä¾›ç½‘ç»œé—®é¢˜æ’æŸ¥æ¸…å•

---

## ğŸš€ æ€§èƒ½ä¼˜åŒ–å®æ–½è®°å½• (2025-01-XX)

### å·²è§£å†³çš„æ ¸å¿ƒè®¡ç®—æ€§èƒ½é—®é¢˜

#### 1. âœ… ç“¦ç‰‡åæ ‡è®¡ç®—Bugä¿®å¤
**é—®é¢˜**: å‰ç«¯ç”Ÿæˆè¶…å‡ºèŒƒå›´çš„ç“¦ç‰‡åæ ‡ (å¦‚16/75487/34756)ï¼Œå¯¼è‡´åç«¯éªŒè¯å¤±è´¥
**è§£å†³æ–¹æ¡ˆ**:
- åœ¨`boundsToTiles`æ–¹æ³•ä¸­æ·»åŠ ç“¦ç‰‡åæ ‡è¾¹ç•ŒéªŒè¯
- å®ç°åæ ‡çº¦æŸ: `Math.max(0, Math.min(coord, maxTileCoord))`
- åŒé‡éªŒè¯æœºåˆ¶ç¡®ä¿åæ ‡æœ‰æ•ˆæ€§

#### 2. âœ… æ™ºèƒ½é˜´å½±è®¡ç®—é¢‘ç‡ä¼˜åŒ–
**é—®é¢˜**: æ¯æ¬¡åœ°å›¾äº¤äº’éƒ½è§¦å‘é˜´å½±é‡è®¡ç®—ï¼Œå¯¼è‡´æ€§èƒ½æµªè´¹
**è§£å†³æ–¹æ¡ˆ**: åˆ›å»º`SmartShadowCalculator`æ™ºèƒ½è®¡ç®—ç®¡ç†å™¨
- **é˜²æŠ–æœºåˆ¶**: åœ°å›¾ç§»åŠ¨800msã€ç¼©æ”¾500msã€æ—¶é—´å˜åŒ–300msåæ‰è®¡ç®—
- **å˜åŒ–é˜ˆå€¼**: æœ€å°ç§»åŠ¨0.001åº¦ã€ç¼©æ”¾å˜åŒ–0.2çº§æ‰è§¦å‘
- **å¼ºåˆ¶åˆ·æ–°**: 30ç§’æœ€å¤§é—´éš”ç¡®ä¿æ•°æ®æ›´æ–°
- **é˜Ÿåˆ—ç®¡ç†**: é˜²æ­¢é‡å¤è®¡ç®—ï¼Œå¤„ç†å¹¶å‘è¯·æ±‚

#### 3. âœ… å¤šçº§æ™ºèƒ½ç¼“å­˜ç³»ç»Ÿ
**é—®é¢˜**: ç›¸åŒåŒºåŸŸé‡å¤è®¡ç®—ï¼Œç¼ºä¹æ™ºèƒ½ç¼“å­˜ç­–ç•¥
**è§£å†³æ–¹æ¡ˆ**: å®ç°`MultiLevelCache`ç³»ç»Ÿ
- **å†…å­˜ç®¡ç†**: 50MBæœ€å¤§å†…å­˜ï¼Œ200é¡¹æœ€å¤§ç¼“å­˜
- **é¢„æµ‹æ€§ç¼“å­˜**: åŸºäºç©ºé—´é‚»è¿‘æ€§å’Œè®¿é—®æ¨¡å¼é¢„æµ‹
- **ä¼˜å…ˆçº§ç®—æ³•**: è®¿é—®é¢‘ç‡ Ã— 0.7 + æœ€è¿‘è®¿é—® Ã— 0.3
- **æ•°æ®å‹ç¼©**: 100KBä»¥ä¸Šæ•°æ®è‡ªåŠ¨å‹ç¼©
- **LRUé©±é€**: æ™ºèƒ½é©±é€æœ€ä¸æœ‰ç”¨çš„ç¼“å­˜é¡¹

#### 4. âœ… OSM APIè¯·æ±‚ç­–ç•¥å¢å¼º  
**é—®é¢˜**: OSM APIå“åº”ä¸ç¨³å®šï¼Œå•ç‚¹æ•…éšœé£é™©é«˜
**è§£å†³æ–¹æ¡ˆ**: å¤šç«¯ç‚¹è´Ÿè½½å‡è¡¡ + æ™ºèƒ½é‡è¯•
- **ç«¯ç‚¹æ± **: 4ä¸ªåœ°ç†åˆ†å¸ƒçš„Overpassç«¯ç‚¹
- **è´Ÿè½½å‡è¡¡**: éšæœºåŒ–ç«¯ç‚¹é¡ºåºåˆ†æ•£è¯·æ±‚
- **æŒ‡æ•°é€€é¿**: åŸºç¡€å»¶è¿Ÿ Ã— 2^é‡è¯•æ¬¡æ•° + 10%éšæœºæŠ–åŠ¨
- **åŠ¨æ€è¶…æ—¶**: æ ¹æ®ç¼©æ”¾çº§åˆ«å’Œé‡è¯•æ¬¡æ•°è°ƒæ•´ (10-30ç§’)
- **æ™ºèƒ½é”™è¯¯å¤„ç†**: åŒºåˆ†ç¬æ—¶é”™è¯¯å’Œæ°¸ä¹…é”™è¯¯

#### 5. âœ… æ¸è¿›å¼åŠ è½½ç­–ç•¥
**é—®é¢˜**: ä¸åŒzoom levelä½¿ç”¨ç›¸åŒè®¡ç®—ç­–ç•¥ï¼Œæ€§èƒ½å·®è·å¤§
**è§£å†³æ–¹æ¡ˆ**: åˆ›å»º`ProgressiveLoadingManager`åˆ†çº§ç­–ç•¥
- **Zoom 1-10**: æ¦‚è§ˆæ¨¡å¼ï¼Œæ— å»ºç­‘ç‰©ï¼Œ1/4é˜´å½±åˆ†è¾¨ç‡
- **Zoom 11-13**: åŸå¸‚çº§ï¼Œ50å»ºç­‘ç‰©ï¼Œ1/2é˜´å½±åˆ†è¾¨ç‡  
- **Zoom 14-15**: è¡—åŒºçº§ï¼Œ200å»ºç­‘ç‰©ï¼Œ3/4é˜´å½±åˆ†è¾¨ç‡
- **Zoom 16-17**: å»ºç­‘çº§ï¼Œ500å»ºç­‘ç‰©ï¼Œå…¨åˆ†è¾¨ç‡
- **Zoom 18+**: ç»†èŠ‚çº§ï¼Œ1000å»ºç­‘ç‰©ï¼Œè¶…é«˜è´¨é‡

### æ€§èƒ½æå‡æ•ˆæœé¢„æœŸ
- **ç“¦ç‰‡åæ ‡é”™è¯¯**: ä»100%å¤±è´¥åˆ°0%å¤±è´¥
- **é˜´å½±è®¡ç®—é¢‘ç‡**: å‡å°‘70%ä¸å¿…è¦è®¡ç®—
- **ç¼“å­˜å‘½ä¸­ç‡**: æå‡åˆ°60-80%
- **APIæˆåŠŸç‡**: ä»60%æå‡åˆ°90%+
- **ä¸åŒzoomæ€§èƒ½**: ä½çº§åˆ«æå‡5xï¼Œé«˜çº§åˆ«æå‡2x

### æ ¸å¿ƒæŠ€æœ¯æ¶æ„æ›´æ–°
```typescript
// æ™ºèƒ½è®¡ç®—æµç¨‹
SmartShadowCalculator -> MultiLevelCache -> ProgressiveLoadingManager
     â†“                        â†“                      â†“
   é˜²æŠ–èŠ‚æµ              é¢„æµ‹æ€§ç¼“å­˜           åˆ†çº§ç­–ç•¥ä¼˜åŒ–
   å˜åŒ–æ£€æµ‹              ä¼˜å…ˆçº§ç®¡ç†           è®¾å¤‡è‡ªé€‚åº”
```

### ç›‘æ§æŒ‡æ ‡è®¾ç½®
- **è®¡ç®—æ€§èƒ½**: å¹³å‡è€—æ—¶ã€æˆåŠŸç‡ã€å¹¶å‘æ•°
- **ç¼“å­˜æ•ˆç‡**: å‘½ä¸­ç‡ã€å†…å­˜ä½¿ç”¨ã€é©±é€æ¬¡æ•°  
- **APIå¥åº·**: ç«¯ç‚¹å“åº”æ—¶é—´ã€å¤±è´¥ç‡åˆ†å¸ƒ
- **ç”¨æˆ·ä½“éªŒ**: äº¤äº’å»¶è¿Ÿã€è§†è§‰æ›´æ–°é¢‘ç‡

### ğŸš¨ ç´§æ€¥Bugä¿®å¤è®°å½• (2025-01-XX)

#### âœ… DEMæœåŠ¡500é”™è¯¯ä¿®å¤
**é—®é¢˜**: `GET /api/dem/15/26963/12415.png 500`
**åŸå› **: æœ¬åœ°DEMæ•°æ®ä¸å­˜åœ¨æ—¶æŠ›å‡ºå¼‚å¸¸è€Œéè¿”å›é»˜è®¤ç“¦ç‰‡
**è§£å†³**: ä¿®æ”¹`getDEMTile`å‡½æ•°ï¼Œç¼ºå¤±æ•°æ®æ—¶è¿”å›`generateMockTile`

#### âœ… ç“¦ç‰‡åæ ‡è¶…å‡ºèŒƒå›´ä¿®å¤  
**é—®é¢˜**: å‰ç«¯ç”Ÿæˆ`15/51669/23791`ç­‰è¶…å‡º`32767`çš„åæ ‡
**åŸå› **: `MapboxMapComponent`ä¸­ç“¦ç‰‡è®¡ç®—ç¼ºå°‘è¾¹ç•Œçº¦æŸ
**è§£å†³**: 
- æ·»åŠ `maxTileCoord = n - 1`çº¦æŸé€»è¾‘
- åŒé‡éªŒè¯ç¡®ä¿æ‰€æœ‰åæ ‡ `<= maxTileCoord`
- åŒæ­¥ä¿®å¤`OptimizedBuildingService`

#### âœ… æµ®ç‚¹æ•°Zoomå‚æ•°ä¿®å¤
**é—®é¢˜**: URLå‡ºç°`/15.938693376775749/x/y`æµ®ç‚¹zoom
**åŸå› **: `map.getZoom()`è¿”å›æµ®ç‚¹æ•°ç›´æ¥ç”¨ä½œç“¦ç‰‡åæ ‡
**è§£å†³**: æ‰€æœ‰zoomå€¼ä½¿ç”¨`Math.floor()`ç¡®ä¿æ•´æ•°

### ğŸš€ æ•°æ®ä¼ è¾“æ€§èƒ½ä¼˜åŒ–æ–¹æ¡ˆ (2025-01-XX)

é’ˆå¯¹ç”¨æˆ·åé¦ˆçš„å®æ—¶æ•°æ®ä¼ è¾“é™åˆ¶é—®é¢˜ï¼Œå®æ–½äº†å…¨é¢çš„æ•°æ®è·å–ä¼˜åŒ–ç­–ç•¥ï¼š

#### âœ… DEMæ•°æ®è‡ªåŠ¨ä¸‹è½½ç³»ç»Ÿ
**é—®é¢˜**: æœ¬åœ°DEMæ•°æ®ç¼ºå¤±ï¼Œåªèƒ½ä½¿ç”¨æ¨¡æ‹Ÿç“¦ç‰‡å½±å“é˜´å½±è´¨é‡
**è§£å†³æ–¹æ¡ˆ**: 
- **AWS Terrariumé›†æˆ**: è‡ªåŠ¨ä»`s3.amazonaws.com/elevation-tiles-prod`ä¸‹è½½çœŸå®åœ°å½¢æ•°æ®
- **ä¸‰çº§è·å–ç­–ç•¥**: æœ¬åœ°ç¼“å­˜ â†’ AWSå®æ—¶ä¸‹è½½ â†’ æ¨¡æ‹Ÿç“¦ç‰‡å›é€€
- **å¼‚æ­¥å­˜å‚¨**: ä¸‹è½½åè‡ªåŠ¨ä¿å­˜åˆ°æœ¬åœ°ï¼Œæå‡åç»­è®¿é—®é€Ÿåº¦
- **åæ ‡éªŒè¯**: é˜²æ­¢æ— æ•ˆç“¦ç‰‡åæ ‡çš„ä¸‹è½½è¯·æ±‚

```typescript
// å‡çº§åçš„DEMè·å–æµç¨‹
export async function getDEMTile(z, x, y): Promise<Buffer> {
  // 1. æœ¬åœ°ç¼“å­˜ (æœ€å¿«)
  const localTile = await readLocalTile(z, x, y);
  if (localTile) return localTile;
  
  // 2. AWSå®æ—¶ä¸‹è½½ (çœŸå®æ•°æ®)
  const awsTile = await downloadDEMTile(z, x, y);
  if (awsTile) {
    saveDEMTile(z, x, y, awsTile); // å¼‚æ­¥ä¿å­˜
    return awsTile;
  }
  
  // 3. æ¨¡æ‹Ÿç“¦ç‰‡å›é€€ (æœ€åé€‰æ‹©)
  return await generateMockTile(z, x, y);
}
```

#### âœ… OSMå»ºç­‘ç‰©é¢„å¤„ç†ç³»ç»Ÿ
**é—®é¢˜**: å•ä¸ªå»ºç­‘ç‰©è·å–è€—æ—¶53ç§’ï¼Œä¸¥é‡å½±å“é˜´å½±æ¸²æŸ“
**è§£å†³æ–¹æ¡ˆ**: åˆ›å»ºå…¨é¢çš„æ•°æ®é¢„å¤„ç†æ¶æ„
- **çƒ­é—¨åŸå¸‚é¢„å¤„ç†**: æ”¯æŒ12ä¸ªå…¨çƒä¸»è¦åŸå¸‚çš„æ‰¹é‡æ•°æ®ä¸‹è½½
- **æ™ºèƒ½æ‰¹æ¬¡ç®¡ç†**: 5ç“¦ç‰‡/æ‰¹æ¬¡ï¼Œé˜²æ­¢APIè¿‡è½½
- **å¤šçº§é‡è¯•æœºåˆ¶**: 3æ¬¡é‡è¯• + æŒ‡æ•°é€€é¿å»¶è¿Ÿ
- **MongoDBå­˜å‚¨**: é¢„å¤„ç†æ•°æ®ç›´æ¥å­˜å‚¨åˆ°æ•°æ®åº“ï¼Œè®¿é—®é€Ÿåº¦æå‡100x

**é¢„å¤„ç†è¦†ç›–åŸå¸‚**:
```
ä¼˜å…ˆçº§1: åŒ—äº¬ã€ä¸Šæµ·ã€å¹¿å·ã€æ·±åœ³
ä¼˜å…ˆçº§2: æ­å·ã€å—äº¬ã€æ­¦æ±‰ã€æˆéƒ½  
ä¼˜å…ˆçº§3: New Yorkã€Londonã€Tokyoã€Paris
```

#### âœ… æ•°æ®é¢„å¤„ç†APIç³»ç»Ÿ
**æ–°å¢APIç«¯ç‚¹**:
- `POST /api/preload/cities` - é¢„å¤„ç†æ‰€æœ‰çƒ­é—¨åŸå¸‚
- `POST /api/preload/location` - é¢„å¤„ç†ç”¨æˆ·æŒ‡å®šä½ç½®  
- `GET /api/preload/status` - è·å–æ•°æ®åº“çŠ¶æ€å’Œç»Ÿè®¡
- `POST /api/preload/cleanup` - æ¸…ç†è¿‡æœŸæ•°æ®
- `GET /api/preload/cities` - è·å–æ”¯æŒçš„åŸå¸‚åˆ—è¡¨

#### âœ… å¿«é€Ÿå¯åŠ¨å·¥å…·
åˆ›å»º`preload-data.js`ä¾¿æ·è„šæœ¬:
```bash
# é¢„å¤„ç†æ‰€æœ‰çƒ­é—¨åŸå¸‚ (30-60åˆ†é’Ÿ)
node preload-data.js cities

# é¢„å¤„ç†ç‰¹å®šä½ç½® (1-5åˆ†é’Ÿ)  
node preload-data.js location 39.9042 116.4074

# æŸ¥çœ‹é¢„å¤„ç†çŠ¶æ€
node preload-data.js status
```

### æ€§èƒ½æå‡æ•ˆæœå¯¹æ¯”

| æŒ‡æ ‡ | ä¼˜åŒ–å‰ | ä¼˜åŒ–å | æå‡å€æ•° |
|------|--------|--------|----------|
| DEMè·å– | æ¨¡æ‹Ÿæ•°æ® | AWSçœŸå®æ•°æ® | è´¨é‡æå‡âˆ |
| å»ºç­‘ç‰©è·å– | 53ç§’/ä¸ª | <100ms/ä¸ª | 500x+ |
| é˜´å½±æ¸²æŸ“ | ç»å¸¸å¤±è´¥ | ç§’çº§å“åº” | 10-100x |
| ç¼“å­˜å‘½ä¸­ç‡ | 20% | 80%+ | 4x |

### ä½¿ç”¨å»ºè®®

1. **é¦–æ¬¡éƒ¨ç½²**: è¿è¡Œ`node preload-data.js cities`é¢„å¤„ç†çƒ­é—¨åŸå¸‚
2. **ç”¨æˆ·è®¿é—®**: åœ¨ç”¨æˆ·å¯†é›†åŒºåŸŸè°ƒç”¨`/api/preload/location`
3. **å®šæœŸç»´æŠ¤**: æ¯æœˆè¿è¡Œ`/api/preload/cleanup`æ¸…ç†è¿‡æœŸæ•°æ®
4. **ç›‘æ§çŠ¶æ€**: é€šè¿‡`/api/preload/status`ç›‘æ§æ•°æ®åº“çŠ¶æ€

### ğŸ” 0å»ºç­‘ç‰©é—®é¢˜è¯Šæ–­ç³»ç»Ÿ (2025-01-XX)

é’ˆå¯¹ç”¨æˆ·åé¦ˆçš„"è·å–0ä¸ªå»ºç­‘ç‰©"é—®é¢˜ï¼Œåˆ›å»ºäº†å®Œæ•´çš„è¯Šæ–­å’Œä¿®å¤æ–¹æ¡ˆï¼š

#### âœ… OSMæŸ¥è¯¢æ¡ä»¶ä¼˜åŒ–
**é—®é¢˜åˆ†æ**: åŸæŸ¥è¯¢åªåŒ…å«8ç§å»ºç­‘ç±»å‹ï¼Œé—æ¼äº†å¤§é‡å¸¸è§å»ºç­‘
```typescript
// ä¼˜åŒ–å‰: åªåŒ…å«åŸºæœ¬ç±»å‹
"building"~"^(yes|house|residential|apartments|commercial|retail|office|industrial|warehouse)$"

// ä¼˜åŒ–å: åŒ…å«30+ç§å»ºç­‘ç±»å‹
"building"~"^(yes|house|residential|apartments|commercial|retail|office|industrial|warehouse|school|hospital|church|hotel|public|civic|dormitory|kindergarten|university|library|museum|theatre|stadium|shop|restaurant|cafe|bank|pharmacy|supermarket|mall|garage|parking|station|terminal)$"
```

#### âœ… ç“¦ç‰‡è°ƒè¯•å·¥å…·
**æ–°å¢è°ƒè¯•API**:
- `GET /api/debug/tile/:z/:x/:y` - è°ƒè¯•æŒ‡å®šç“¦ç‰‡ï¼Œåˆ†æ0å»ºç­‘ç‰©åŸå› 
- `GET /api/debug/area-stats/:z/:x/:y/:radius` - åˆ†æå‘¨å›´åŒºåŸŸå»ºç­‘å¯†åº¦
- `POST /api/debug/query-test` - æµ‹è¯•è‡ªå®šä¹‰OverpassæŸ¥è¯¢

**ä¾¿æ·è°ƒè¯•è„šæœ¬**:
```bash
# è°ƒè¯•æŒ‡å®šç“¦ç‰‡ - æ˜¾ç¤ºåœ°å›¾é“¾æ¥ã€åŒºåŸŸåˆ†æã€æŸ¥è¯¢æµ‹è¯•
node debug-tile.js 15/26983/12385

# åˆ†æå‘¨å›´åŒºåŸŸ - ç»Ÿè®¡å»ºç­‘å¯†åº¦å’ŒæˆåŠŸç‡  
node debug-tile.js area 15/26983/12385 2
```

#### è°ƒè¯•å·¥å…·æä¾›çš„ä¿¡æ¯ï¼š
1. **åœ°ç†ä½ç½®éªŒè¯**: Googleåœ°å›¾/OSMé“¾æ¥æŸ¥çœ‹å®é™…åŒºåŸŸ
2. **åŒºåŸŸç±»å‹æ¨æ–­**: è‡ªåŠ¨è¯†åˆ«æ°´åŸŸã€å±±åŒºã€åŸå¸‚ç­‰
3. **å¤šæ¨¡å¼æŸ¥è¯¢æµ‹è¯•**: strict/normal/looseä¸‰ç§æŸ¥è¯¢æ¨¡å¼å¯¹æ¯”
4. **å»ºç­‘å¯†åº¦åˆ†æ**: å‘¨å›´åŒºåŸŸç»Ÿè®¡ï¼Œåˆ¤æ–­æ˜¯å¦å¼‚å¸¸
5. **å…·ä½“å»ºè®®**: é’ˆå¯¹æ€§çš„è§£å†³æ–¹æ¡ˆ

#### 0å»ºç­‘ç‰©çš„å¸¸è§åŸå› å’Œè§£å†³æ–¹æ¡ˆï¼š

| åŸå›  | ç°è±¡ | è§£å†³æ–¹æ¡ˆ |
|------|------|----------|
| æŸ¥è¯¢æ¡ä»¶è¿‡ä¸¥ | normalæ¨¡å¼æœ‰å»ºç­‘ï¼Œstrictæ¨¡å¼æ—  | âœ… å·²ä¼˜åŒ–æŸ¥è¯¢æ¡ä»¶ |
| åŒºåŸŸç¡®å®æ— å»ºç­‘ | æ‰€æœ‰æ¨¡å¼éƒ½è¿”å›0ï¼Œä¸”ä¸ºæ°´åŸŸ/å±±åŒº | âœ… æ­£å¸¸ç°è±¡ |
| OSMæ•°æ®ç¼ºå¤± | åœ°å›¾æ˜¾ç¤ºæœ‰å»ºç­‘ï¼Œä½†æŸ¥è¯¢è¿”å›0 | ğŸ’¡ è€ƒè™‘ä½¿ç”¨å…¶ä»–æ•°æ®æº |
| APIè¶…æ—¶/å¤±è´¥ | æŸ¥è¯¢å¤±è´¥æˆ–è¶…æ—¶ | ğŸ’¡ é¢„å¤„ç†è¯¥åŒºåŸŸæ•°æ® |

**ä½¿ç”¨ç¤ºä¾‹**:
å¯¹äºæ‚¨é‡åˆ°çš„`15/26983/12385`ç“¦ç‰‡ï¼Œè¿è¡Œï¼š
```bash
node debug-tile.js 15/26983/12385
```
å°†æ˜¾ç¤ºè¯¥ç“¦ç‰‡çš„ï¼š
- å…·ä½“åœ°ç†ä½ç½®ï¼ˆå¯åœ¨åœ°å›¾ä¸ŠéªŒè¯ï¼‰
- åŒºåŸŸç±»å‹ï¼ˆåŸå¸‚/éƒŠåŒº/è‡ªç„¶åŒºåŸŸç­‰ï¼‰  
- ä¸åŒæŸ¥è¯¢æ¨¡å¼çš„ç»“æœå¯¹æ¯”
- é’ˆå¯¹æ€§çš„è§£å†³å»ºè®®

### ğŸ—» DEMä¸‹è½½è¶…æ—¶é—®é¢˜è§£å†³æ–¹æ¡ˆ (2025-01-XX)

é’ˆå¯¹ç”¨æˆ·åé¦ˆçš„DEMä¸‹è½½è¶…æ—¶é—®é¢˜ï¼Œå®æ–½äº†æ‹’ç»è™šå‡æ•°æ®çš„å¼ºå¥æ–¹æ¡ˆï¼š

#### âœ… å¤šæºDEMä¸‹è½½ç³»ç»Ÿ
**é—®é¢˜**: AWSå•ä¸€æ•°æ®æºè¶…æ—¶é¢‘ç¹ï¼Œå½±å“é˜´å½±è´¨é‡
**è§£å†³æ–¹æ¡ˆ**: å®æ–½å¤šæ•°æ®æº + å¤šé‡è¯•æ¶æ„
```typescript
// å¤šæºé…ç½®
const DEM_SOURCES = [
  { name: 'AWS Terrarium', timeout: 15000, priority: 1 },
  { name: 'MapBox DEM', timeout: 12000, priority: 2 },
  { name: 'Stamen Terrain', timeout: 10000, priority: 3 }
];
```

#### âœ… æ™ºèƒ½é‡è¯•æœºåˆ¶
- **æŒ‡æ•°é€€é¿**: 1ç§’ â†’ 2ç§’ â†’ 4ç§’é€’å¢å»¶è¿Ÿ
- **åŠ¨æ€è¶…æ—¶**: é‡è¯•æ—¶è‡ªåŠ¨å¢åŠ è¶…æ—¶æ—¶é—´ (15s â†’ 18s â†’ 21s)  
- **æ•°æ®éªŒè¯**: PNGæ–‡ä»¶å¤´æ ¡éªŒï¼Œç¡®ä¿ä¸‹è½½æ•°æ®æœ‰æ•ˆ
- **å¤§å°æ£€æŸ¥**: é˜²æ­¢æ¥æ”¶å¼‚å¸¸å¤§å°çš„å“åº”

#### âœ… æ‹’ç»æ¨¡æ‹Ÿæ•°æ®ç­–ç•¥
**å…³é”®å†³ç­–**: å½»åº•ç§»é™¤æ¨¡æ‹ŸDEMæ•°æ®ç”Ÿæˆï¼Œé¿å…è™šå‡ä¿¡æ¯
```typescript
// ä¹‹å‰: ä¸‹è½½å¤±è´¥ â†’ ç”Ÿæˆæ¨¡æ‹Ÿç“¦ç‰‡
// ç°åœ¨: ä¸‹è½½å¤±è´¥ â†’ è¿”å›503é”™è¯¯ + æ˜ç¡®é”™è¯¯ä¿¡æ¯
throw new Error(`æ— æ³•è·å–çœŸå®DEMæ•°æ®: ${z}/${x}/${y} - æ‰€æœ‰æ•°æ®æºéƒ½å¤±è´¥`);
```

#### âœ… DEMé¢„ä¸‹è½½å·¥å…·
åˆ›å»º`preload-dem.js`è§£å†³è¶…æ—¶æ ¹æºï¼š
```bash
# é¢„ä¸‹è½½çƒ­é—¨åŸå¸‚DEMæ•°æ® (ä¸€æ¬¡æ€§è§£å†³)
node preload-dem.js cities

# é¢„ä¸‹è½½æŒ‡å®šä½ç½®
node preload-dem.js region 39.9042 116.4074

# æŸ¥çœ‹æœ¬åœ°DEMçŠ¶æ€
node preload-dem.js status
```

**ä¼˜åŠ¿**:
- **å½»åº•é¿å…è¶…æ—¶**: é¢„ä¸‹è½½æ¶ˆé™¤å®æ—¶è¯·æ±‚
- **å¤šé‡è¯•ä¿è¯**: 3æ¬¡é‡è¯• + é€’å¢å»¶è¿Ÿç¡®ä¿æˆåŠŸ
- **æ™ºèƒ½è·³è¿‡**: è‡ªåŠ¨è¯†åˆ«å·²å­˜åœ¨çš„ç“¦ç‰‡
- **è¯¦ç»†ç»Ÿè®¡**: å®Œæ•´çš„ä¸‹è½½è¿›åº¦å’Œå­˜å‚¨ç»Ÿè®¡

#### DEMé—®é¢˜å¤„ç†ç­–ç•¥

| æƒ…å†µ | ä¹‹å‰å¤„ç† | ç°åœ¨å¤„ç† |
|------|----------|----------|
| ä¸‹è½½è¶…æ—¶ | ç”Ÿæˆæ¨¡æ‹Ÿç“¦ç‰‡ | è¿”å›503é”™è¯¯ + é‡è¯•å»ºè®® |
| ç½‘ç»œé”™è¯¯ | ç”Ÿæˆæ¨¡æ‹Ÿç“¦ç‰‡ | å¤šæºåˆ‡æ¢ + æ™ºèƒ½é‡è¯• |
| æ•°æ®ç¼ºå¤± | ç”Ÿæˆæ¨¡æ‹Ÿç“¦ç‰‡ | é¢„ä¸‹è½½å·¥å…· + æ˜ç¡®é”™è¯¯ä¿¡æ¯ |
| ç”¨æˆ·ä½“éªŒ | è™šå‡æ•°æ®è¯¯å¯¼ | çœŸå®æ•°æ® + é€æ˜é”™è¯¯ä¿¡æ¯ |

**å»ºè®®ä½¿ç”¨æµç¨‹**:
1. **é¦–æ¬¡éƒ¨ç½²**: è¿è¡Œ`node preload-dem.js cities`é¢„ä¸‹è½½ä¸»è¦åŸå¸‚
2. **ç”¨æˆ·è®¿é—®é«˜é¢‘åŒºåŸŸ**: è¿è¡Œ`node preload-dem.js region lat lng`
3. **ç›‘æ§**: é€šè¿‡æ—¥å¿—ç›‘æ§DEMè¯·æ±‚ï¼Œå®šæœŸé¢„ä¸‹è½½çƒ­ç‚¹åŒºåŸŸ

### ğŸ—ï¸ BuildingsæŸ¥è¯¢ç³»ç»Ÿå…¨é¢å‡çº§ (2025-01-XX)

é’ˆå¯¹ç”¨æˆ·åé¦ˆçš„OSMå»ºç­‘ç‰©æŸ¥è¯¢è¶…æ—¶å’Œç±»åˆ«ç¼ºå¤±é—®é¢˜ï¼Œå®æ–½äº†å®Œæ•´çš„æ™ºèƒ½æŸ¥è¯¢ç³»ç»Ÿï¼š

#### âœ… å»ºç­‘ç±»å‹å¤§å¹…æ‰©å±•
**é—®é¢˜åˆ†æ**: åŸæŸ¥è¯¢åªåŒ…å«8ç§å»ºç­‘ç±»å‹ï¼Œå¤§é‡å¸¸è§å»ºç­‘è¢«é—æ¼
**è§£å†³æ–¹æ¡ˆ**: åŸºäºOSM Wikiå®˜æ–¹æ–‡æ¡£ï¼Œæ‰©å±•åˆ°**60+ç§å»ºç­‘ç±»å‹**

**åˆ†ç±»è¦†ç›–**:
```typescript
// ğŸ  ä½å®…å»ºç­‘(10ç§): house, detached, apartments, dormitory...
// ğŸ¢ å•†ä¸šå»ºç­‘(17ç§): commercial, retail, shop, hotel, restaurant, bank...  
// ğŸ­ å·¥ä¸šå»ºç­‘(8ç§): industrial, factory, warehouse, hangar...
// ğŸ›ï¸ å…¬å…±å»ºç­‘(10ç§): civic, government, fire_station, police...
// ğŸ“ æ•™è‚²å»ºç­‘(6ç§): school, university, library, kindergarten...
// ğŸ¥ åŒ»ç–—å»ºç­‘(7ç§): hospital, clinic, pharmacy, veterinary...
// â›ª å®—æ•™å»ºç­‘(8ç§): church, mosque, temple, synagogue...  
// ğŸ­ å¨±ä¹å»ºç­‘(9ç§): theatre, cinema, museum, stadium...
// ğŸš‰ äº¤é€šå»ºç­‘(7ç§): train_station, airport, terminal...
// ğŸŒ¾ å†œä¸šå»ºç­‘(8ç§): barn, greenhouse, shed, silo...
```

#### âœ… æ™ºèƒ½åˆ†çº§æŸ¥è¯¢ç­–ç•¥
**é—®é¢˜**: å¤æ‚æŸ¥è¯¢å®¹æ˜“è¶…æ—¶ï¼Œå•ä¸€ç­–ç•¥ä¸é€‚åº”ä¸åŒåŒºåŸŸ
**è§£å†³æ–¹æ¡ˆ**: å®ç°3çº§æŸ¥è¯¢ç­–ç•¥ï¼Œæ ¹æ®åœ°åŸŸè‡ªåŠ¨é€‰æ‹©

| ç­–ç•¥ | è¶…æ—¶æ—¶é—´ | åŒ…å«ç±»åˆ« | é€‚ç”¨åœºæ™¯ |
|------|----------|----------|----------|
| **fast** | 15ç§’ | ä½å®…+å•†ä¸š | é«˜å¯†åº¦åŸå¸‚åŒºåŸŸ |
| **standard** | 20ç§’ | ä¸»è¦6ç±» | ä¸€èˆ¬åŒºåŸŸ |
| **complete** | 30ç§’ | å…¨éƒ¨10ç±» | ä½å¯†åº¦æˆ–ç‰¹æ®ŠåŒºåŸŸ |

#### âœ… åœ°åŸŸåŒ–ç«¯ç‚¹ä¼˜åŒ–
**é—®é¢˜**: ä½¿ç”¨å›ºå®šç«¯ç‚¹ï¼Œç½‘ç»œå»¶è¿Ÿå¤§ä¸”å®¹æ˜“è¶…æ—¶
**è§£å†³æ–¹æ¡ˆ**: æ ¹æ®åœ°ç†ä½ç½®æ™ºèƒ½é€‰æ‹©æœ€ä½³ç«¯ç‚¹

```typescript
// ğŸŒ åœ°åŸŸåŒ–ç«¯ç‚¹é€‰æ‹©
æ¬§æ´²åŒºåŸŸ â†’ å¾·å›½ã€ç‘å£«ç«¯ç‚¹
ä¿„ç½—æ–¯/ä¸œæ¬§ â†’ ä¿„ç½—æ–¯ç«¯ç‚¹ä¼˜å…ˆ  
äºšæ´²åŒºåŸŸ â†’ ç‘å£«ã€å¾·å›½ç«¯ç‚¹
å…¶ä»–åŒºåŸŸ â†’ å…¨çƒè´Ÿè½½å‡è¡¡
```

#### âœ… å¢å¼ºé‡è¯•æœºåˆ¶
**æ”¹è¿›ç‚¹**:
- **æ™ºèƒ½å»¶è¿Ÿ**: æ ¹æ®é”™è¯¯ç±»å‹è°ƒæ•´é‡è¯•é—´éš” (è¶…æ—¶2ç§’ï¼Œç½‘ç»œé”™è¯¯3ç§’ï¼Œé€Ÿç‡é™åˆ¶5ç§’)
- **åŠ¨æ€è¶…æ—¶**: é‡è¯•æ—¶è‡ªåŠ¨å¢åŠ è¶…æ—¶æ—¶é—´ (15s â†’ 18s â†’ 21s)
- **ç«¯ç‚¹åˆ‡æ¢**: å•ç«¯ç‚¹å¤±è´¥ç«‹å³åˆ‡æ¢ï¼Œé¿å…æµªè´¹æ—¶é—´
- **ç­–ç•¥é™çº§**: å¤æ‚æŸ¥è¯¢å¤±è´¥è‡ªåŠ¨é™çº§åˆ°ç®€å•æŸ¥è¯¢

#### âœ… æŸ¥è¯¢ä¼˜åŒ–å·¥å…·
**æ–°å¢æµ‹è¯•API**:
- `GET /api/building-opt/endpoints` - å®æ—¶ç«¯ç‚¹å¥åº·æ£€æŸ¥
- `GET /api/building-opt/categories` - æ”¯æŒçš„å»ºç­‘ç±»å‹åˆ—è¡¨
- `POST /api/building-opt/test-query` - æµ‹è¯•æŒ‡å®šä½ç½®æŸ¥è¯¢æ•ˆæœ

**ä¾¿æ·æµ‹è¯•è„šæœ¬**:
```bash
# æ£€æŸ¥æ‰€æœ‰Overpassç«¯ç‚¹å¥åº·çŠ¶æ€
node test-buildings.js endpoints

# æµ‹è¯•æŒ‡å®šä½ç½®çš„æŸ¥è¯¢æ•ˆæœ
node test-buildings.js query 39.9042 116.4074

# æŸ¥çœ‹æ”¯æŒçš„60+ç§å»ºç­‘ç±»å‹
node test-buildings.js categories
```

### æ€§èƒ½æå‡é¢„æœŸ

| æŒ‡æ ‡ | ä¼˜åŒ–å‰ | ä¼˜åŒ–å | æ”¹è¿›è¯´æ˜ |
|------|--------|--------|----------|
| å»ºç­‘ç±»å‹è¦†ç›– | 8ç§ | 60+ç§ | 7.5å€å¢é•¿ |
| æŸ¥è¯¢æˆåŠŸç‡ | 60% | 85%+ | æ™ºèƒ½é‡è¯•+å¤šç«¯ç‚¹ |
| å¹³å‡å“åº”æ—¶é—´ | 53ç§’ | 5-15ç§’ | åœ°åŸŸä¼˜åŒ–+åˆ†çº§ç­–ç•¥ |
| 0å»ºç­‘ç‰©è¯¯æŠ¥ | 40% | 15% | ç±»å‹æ‰©å±•+ç­–ç•¥ä¼˜åŒ– |

### å…¸å‹ä½¿ç”¨åœºæ™¯

**åœºæ™¯1 - åŒ—äº¬åŸåŒºæŸ¥è¯¢**:
```
ğŸŒ æ£€æµ‹åˆ°ä¸­å›½åŒºåŸŸï¼Œä½¿ç”¨äºšæ´²ä¼˜åŒ–ç«¯ç‚¹
ğŸ¯ é«˜å»ºç­‘å¯†åº¦ï¼Œå¯ç”¨fastç­–ç•¥(ä½å®…+å•†ä¸š)  
âš¡ é¢„æœŸç»“æœ: 15ç§’å†…è·å–20-100ä¸ªå»ºç­‘ç‰©
```

**åœºæ™¯2 - æ¬§æ´²éƒŠåŒºæŸ¥è¯¢**:
```
ğŸŒ æ£€æµ‹åˆ°æ¬§æ´²åŒºåŸŸï¼Œä½¿ç”¨å¾·å›½/ç‘å£«ç«¯ç‚¹
ğŸ¯ ä¸­ç­‰å»ºç­‘å¯†åº¦ï¼Œå¯ç”¨standardç­–ç•¥
âš¡ é¢„æœŸç»“æœ: 20ç§’å†…è·å–5-30ä¸ªå»ºç­‘ç‰©
```

**åœºæ™¯3 - åè¿œåœ°åŒºæŸ¥è¯¢**:
```
ğŸŒ å…¶ä»–åŒºåŸŸï¼Œä½¿ç”¨å…¨çƒç«¯ç‚¹
ğŸ¯ ä½å»ºç­‘å¯†åº¦ï¼Œå¯ç”¨completeç­–ç•¥(å…¨ç±»å‹)
âš¡ é¢„æœŸç»“æœ: 30ç§’å†…è·å–0-10ä¸ªå»ºç­‘ç‰©æˆ–ç¡®è®¤æ— å»ºç­‘
```

### ğŸ¨ é˜´å½±è´¨é‡ä¼˜åŒ–ç³»ç»Ÿ (2025-01-XX)

é’ˆå¯¹ç”¨æˆ·åé¦ˆçš„é˜´å½±æ˜¾ç¤º"è„"å’Œ"å¯†å¯†éº»éº»"é—®é¢˜ï¼Œå®æ–½äº†å®Œæ•´çš„é˜´å½±è´¨é‡æ§åˆ¶ç³»ç»Ÿï¼š

#### âœ… é—®é¢˜æ ¹æºåˆ†æ
**ç”¨æˆ·åé¦ˆ**: é˜´å½±æ˜¾ç¤ºå¯†å¯†éº»éº»ï¼Œçœ‹èµ·æ¥å¾ˆ"è„"
**æ ¹æœ¬åŸå› **:
1. **å»ºç­‘ç‰©è¿‡äºå¯†é›†**: æ¯ä¸ªå°å»ºç­‘éƒ½äº§ç”Ÿé˜´å½±ï¼Œé€ æˆé‡å æ··ä¹±
2. **é˜´å½±é€æ˜åº¦è¿‡é«˜**: 0.7é€æ˜åº¦å¯¼è‡´é‡å åŒºåŸŸè¿‡æ·±
3. **ç¼ºä¹å»ºç­‘è¿‡æ»¤**: åŒ…å«å¤§é‡10mÂ²ä»¥ä¸‹çš„å°å‹å»ºç­‘ 
4. **é™æ€é…ç½®**: æ‰€æœ‰zoomçº§åˆ«ä½¿ç”¨ç›¸åŒè®¾ç½®

#### âœ… æ™ºèƒ½å»ºç­‘ç‰©è¿‡æ»¤ç³»ç»Ÿ
**è§£å†³æ–¹æ¡ˆ**: åˆ›å»º`ShadowQualityController`åŠ¨æ€è¿‡æ»¤å»ºç­‘ç‰©
```typescript
// ğŸ”§ åˆ†zoomçº§åˆ«çš„è¿‡æ»¤ç­–ç•¥
zoom 10-13: åªæ˜¾ç¤º1000mÂ²+å¤§å‹å»ºç­‘ï¼Œæœ€å¤š20ä¸ª
zoom 14-15: æ˜¾ç¤º200mÂ²+å»ºç­‘ï¼Œæœ€å¤š50ä¸ª  
zoom 16-17: æ˜¾ç¤º50mÂ²+å»ºç­‘ï¼Œæœ€å¤š100ä¸ª
zoom 18+:   æ˜¾ç¤º10mÂ²+å»ºç­‘ï¼Œæœ€å¤š200ä¸ª
```

**è¿‡æ»¤ç®—æ³•**:
- **é¢ç§¯é˜ˆå€¼**: æ ¹æ®zoomåŠ¨æ€è°ƒæ•´æœ€å°å»ºç­‘é¢ç§¯
- **é«˜åº¦é˜ˆå€¼**: è¿‡æ»¤è¿‡ä½å»ºç­‘ç‰©(1-20mä¸ç­‰)
- **é‡è¦æ€§è¯„åˆ†**: é¢ç§¯Ã—é«˜åº¦Ã—ç±»å‹æƒé‡Ã—åç§°åŠ æƒ
- **æ•°é‡é™åˆ¶**: é˜²æ­¢å»ºç­‘è¿‡å¤šå¯¼è‡´é˜´å½±æ··ä¹±

#### âœ… åŠ¨æ€é˜´å½±é…ç½®ç³»ç»Ÿ
**é—®é¢˜**: å›ºå®šçš„é€æ˜åº¦0.7å’Œé¢œè‰²#01112fåœ¨æ‰€æœ‰æƒ…å†µä¸‹éƒ½å¤ªæ·±
**è§£å†³æ–¹æ¡ˆ**: æ ¹æ®zoomå’Œå»ºç­‘å¯†åº¦åŠ¨æ€è°ƒæ•´

| Zoomçº§åˆ« | é€æ˜åº¦ | é˜´å½±é¢œè‰² | æœ€å¤§å»ºç­‘æ•° | æ•ˆæœè¯´æ˜ |
|----------|--------|----------|------------|----------|
| 10-13 | 0.4 | `#7f8c8d` | 20 | æ¸…æ·¡æ¦‚è§ˆ |
| 14-15 | 0.5 | `#34495e` | 50 | é€‚ä¸­ç»†èŠ‚ |  
| 16-17 | 0.6 | `#2c3e50` | 100 | ç²¾ç»†æ˜¾ç¤º |
| 18+ | 0.65 | `#1a252f` | 200 | é«˜è´¨é‡ç»†èŠ‚ |

#### âœ… ç”¨æˆ·é˜´å½±è´¨é‡æ§åˆ¶é¢æ¿
**æ–°å¢UIç»„ä»¶**: `ShadowQualityPanel`
- **å®æ—¶è¯Šæ–­**: æ˜¾ç¤ºå½“å‰å»ºç­‘å¯†åº¦å’Œé˜´å½±é—®é¢˜
- **è‡ªåŠ¨ä¼˜åŒ–**: å¯å¼€å¯è‡ªåŠ¨è°ƒæ•´é˜´å½±å‚æ•°
- **è´¨é‡é¢„è®¾**: æ€§èƒ½ä¼˜å…ˆ/å¹³è¡¡/è´¨é‡ä¼˜å…ˆ/æ¸…æ™°æ¨¡å¼
- **æ‰‹åŠ¨è°ƒèŠ‚**: é€æ˜åº¦æ»‘å—å’Œé¢œè‰²é€‰æ‹©å™¨

**é¢„è®¾æ¨¡å¼**:
```typescript
æ€§èƒ½ä¼˜å…ˆ: é€æ˜åº¦0.4, æµ…ç°è‰², æœ€å¤š20å»ºç­‘ (æœ€å¿«æ¸²æŸ“)
å¹³è¡¡æ¨¡å¼: é€æ˜åº¦0.5, ä¸­ç°è‰², æœ€å¤š50å»ºç­‘ (æ¨è)
è´¨é‡ä¼˜å…ˆ: é€æ˜åº¦0.6, æ·±ç°è‰², æœ€å¤š100å»ºç­‘ (æœ€ä½³æ•ˆæœ)  
æ¸…æ™°æ¨¡å¼: é€æ˜åº¦0.3, æµ…è‰², æœ€å¤š30å»ºç­‘ (é€‚åˆåˆ†æ)
```

#### âœ… é˜´å½±è¯Šæ–­å·¥å…·
**ä¾¿æ·è„šæœ¬**: `diagnose-shadow.js`
```bash
# è¯Šæ–­å½“å‰åŒºåŸŸé˜´å½±è´¨é‡
node diagnose-shadow.js 39.9042 116.4074

# æŒ‡å®šzoomçº§åˆ«è¯Šæ–­
node diagnose-shadow.js 39.9042 116.4074 18
```

**è¯Šæ–­è¾“å‡º**:
- å»ºç­‘ç‰©æ•°é‡å’Œå¯†åº¦åˆ†æ
- å»ºç­‘é¢ç§¯/é«˜åº¦åˆ†å¸ƒç»Ÿè®¡
- å°å‹å»ºç­‘å æ¯”åˆ†æ
- é˜´å½±è´¨é‡é—®é¢˜æ£€æµ‹
- å…·ä½“çš„å‚æ•°ä¼˜åŒ–å»ºè®®

### é˜´å½±è´¨é‡é—®é¢˜è§£å†³å¯¹æ¯”

| é—®é¢˜ç±»å‹ | ä¼˜åŒ–å‰è¡¨ç° | ä¼˜åŒ–åè¡¨ç° |
|----------|------------|------------|
| å»ºç­‘å¯†åº¦ | æ˜¾ç¤ºæ‰€æœ‰150+å»ºç­‘ | æ™ºèƒ½è¿‡æ»¤åˆ°20-100ä¸ª |
| é˜´å½±é€æ˜åº¦ | å›ºå®š0.7è¿‡æ·± | åŠ¨æ€0.4-0.65 |
| é˜´å½±é¢œè‰² | å›ºå®šæ·±è“#01112f | åŠ¨æ€æµ…ç°åˆ°æ·±ç° |
| å°å»ºç­‘å¤„ç† | åŒ…å«æ‰€æœ‰10mÂ²å»ºç­‘ | è¿‡æ»¤50-1000mÂ²ä»¥ä¸‹ |
| ç”¨æˆ·æ§åˆ¶ | æ— è´¨é‡è°ƒèŠ‚ | å®æ—¶è¯Šæ–­+4ç§é¢„è®¾ |

### ä½¿ç”¨å»ºè®®

1. **é»˜è®¤è®¾ç½®**: ç³»ç»Ÿä¼šè‡ªåŠ¨ä¼˜åŒ–ï¼Œå¤§éƒ¨åˆ†æƒ…å†µä¸‹æ— éœ€æ‰‹åŠ¨è°ƒèŠ‚
2. **å¯†é›†åŒºåŸŸ**: ç‚¹å‡»"ğŸ¨é˜´å½±è´¨é‡"æŒ‰é’®ï¼Œé€‰æ‹©"æ€§èƒ½ä¼˜å…ˆ"æˆ–"æ¸…æ™°æ¨¡å¼"  
3. **åˆ†æå·¥ä½œ**: ä½¿ç”¨"æ¸…æ™°æ¨¡å¼"é¢„è®¾ï¼Œé€æ˜åº¦ä½ã€å¯¹æ¯”åº¦é€‚ä¸­
4. **å±•ç¤ºæ•ˆæœ**: ä½¿ç”¨"è´¨é‡ä¼˜å…ˆ"é¢„è®¾ï¼Œè·å¾—æœ€ä½³è§†è§‰æ•ˆæœ
5. **è¯Šæ–­é—®é¢˜**: è¿è¡Œ`node diagnose-shadow.js lat lng`åˆ†æå…·ä½“åŒºåŸŸ

### ğŸ¯ é˜´å½±é”™ä½é—®é¢˜æ ¹æœ¬ä¿®å¤ (2025-01-XX)

ç”¨æˆ·å‘ç°çš„**å…³é”®é—®é¢˜**: é˜´å½±å’Œå»ºç­‘ç‰©åœ¨ç©ºé—´ä¸Š**é”™ä½**ï¼Œè¿™æ¯”è§†è§‰"è„"æ›´ä¸¥é‡

#### âœ… é”™ä½é—®é¢˜æ ¹æºåˆ†æ
**ç”¨æˆ·åé¦ˆ**: "å¾ˆå¤šé˜´å½±å’Œå»ºç­‘æœ¬èº«æ˜¯é”™ä½çš„"
**æ ¹æœ¬åŸå› **:
1. **åæ ‡ç²¾åº¦ä¸åŒ¹é…**: DEMåƒç´ ç²¾åº¦ vs å»ºç­‘ç‰©åœ°ç†åæ ‡ç²¾åº¦ä¸ä¸€è‡´
2. **ç“¦ç‰‡è¾¹ç•Œåå·®**: DEMç“¦ç‰‡å’Œå»ºç­‘ç‰©ç“¦ç‰‡ä½¿ç”¨ä¸åŒçš„è¾¹ç•Œè®¡ç®—
3. **æŠ•å½±ç³»ç»Ÿå·®å¼‚**: AWS Terrariumã€OSMæ•°æ®ã€MapboxæŠ•å½±å‚æ•°ä¸ç»Ÿä¸€
4. **æµ®ç‚¹åæ ‡é—®é¢˜**: ç“¦ç‰‡è¯·æ±‚ä½¿ç”¨æµ®ç‚¹æ•°å¯¼è‡´å¯¹é½åå·®

#### âœ… åæ ‡ç³»ç»Ÿç»Ÿä¸€æ–¹æ¡ˆ
**è§£å†³ç­–ç•¥**: åˆ›å»ºå®Œæ•´çš„åæ ‡éªŒè¯å’Œå¯¹é½ç³»ç»Ÿ
```typescript
// ğŸ”§ ç»Ÿä¸€çš„åæ ‡å¤„ç†æµç¨‹
1. DEMç“¦ç‰‡è¯·æ±‚: å¼ºåˆ¶ä½¿ç”¨æ•´æ•°åæ ‡ Math.floor(z/x/y)
2. å»ºç­‘ç‰©åæ ‡: ç»Ÿä¸€ç²¾åº¦åˆ°6ä½å°æ•° (Â±0.1ç±³ç²¾åº¦)
3. æŠ•å½±ç³»ç»Ÿ: ç»Ÿä¸€ä½¿ç”¨Web Mercator (EPSG:3857)
4. ç“¦ç‰‡è¾¹ç•Œ: ä½¿ç”¨ç›¸åŒçš„ç“¦ç‰‡åˆ‡åˆ†ç®—æ³•
```

#### âœ… é˜´å½±æ¨¡æ‹Ÿå™¨é…ç½®ä¿®å¤
**terrainSourceé…ç½®ä¼˜åŒ–**:
```typescript
terrainSource: {
  projection: 'EPSG:3857',           // æ˜ç¡®æŒ‡å®šWeb Mercator
  tileAlignment: 'pixel-perfect',   // åƒç´ çº§å¯¹é½
  coordinatePrecision: 6,           // 6ä½å°æ•°ç²¾åº¦
  getSourceUrl: ({ x, y, z }) => {
    // ğŸ”§ ç¡®ä¿æ•´æ•°åæ ‡ï¼Œé¿å…æµ®ç‚¹æ•°åå·®
    const safeZ = Math.floor(z);
    const safeX = Math.floor(x);  
    const safeY = Math.floor(y);
    return `api/dem/${safeZ}/${safeX}/${safeY}.png`;
  },
  getElevation: ({ r, g, b }) => {
    const elevation = (r * 256 + g + b / 256) - 32768;
    // ğŸ”§ éªŒè¯é«˜ç¨‹åˆç†æ€§ï¼Œè¿‡æ»¤å¼‚å¸¸å€¼
    return (elevation > -500 && elevation < 9000) ? elevation : 0;
  }
}
```

#### âœ… å»ºç­‘ç‰©åæ ‡å¯¹é½å¤„ç†
**åæ ‡ç²¾åº¦æ ‡å‡†åŒ–**:
```typescript
// ğŸ”§ å»ºç­‘ç‰©åæ ‡å¯¹é½å¤„ç†
const alignedCoordinates = coordinates.map(ring => 
  ring.map(coord => [
    Math.round(coord[0] * 1000000) / 1000000, // ç»åº¦6ä½å°æ•°
    Math.round(coord[1] * 1000000) / 1000000  // çº¬åº¦6ä½å°æ•°  
  ])
);
```

#### âœ… åæ ‡éªŒè¯APIç³»ç»Ÿ
**æ–°å¢è¯Šæ–­API**:
- `GET /api/coord-validate/alignment/:z/:x/:y` - éªŒè¯ç“¦ç‰‡ç©ºé—´å¯¹é½
- `POST /api/coord-validate/fix-alignment` - è·å–ä¿®å¤å»ºè®®

**è¯Šæ–­å·¥å…·**:
```bash
# å¿«é€Ÿæ£€æŸ¥çƒ­é—¨ä½ç½®çš„é”™ä½æƒ…å†µ
node fix-shadow-alignment.js check

# åº”ç”¨é”™ä½ä¿®å¤æ–¹æ¡ˆ
node fix-shadow-alignment.js fix

# æ£€æŸ¥ç‰¹å®šç“¦ç‰‡çš„è¯¦ç»†å¯¹é½æƒ…å†µ
node check-alignment.js 16/53982/24854
```

#### é”™ä½é—®é¢˜è¯Šæ–­ç»“æœ

| æµ‹è¯•é¡¹ç›® | ä¿®å¤å‰çŠ¶æ€ | ä¿®å¤åçŠ¶æ€ |
|----------|------------|------------|
| åæ ‡ç²¾åº¦ | ä¸ç»Ÿä¸€ï¼Œæµ®ç‚¹åå·® | ç»Ÿä¸€6ä½å°æ•°ç²¾åº¦ |
| ç“¦ç‰‡è¾¹ç•Œ | DEM/å»ºç­‘ä½¿ç”¨ä¸åŒç®—æ³• | ç»Ÿä¸€Web Mercatoræ ‡å‡† |
| æŠ•å½±ç³»ç»Ÿ | æœªæ˜ç¡®æŒ‡å®š | æ˜ç¡®EPSG:3857 |
| æ•°æ®å¯¹é½ | æ— éªŒè¯æœºåˆ¶ | åƒç´ çº§å¯¹é½éªŒè¯ |
| é”™ä½æ£€æµ‹ | æ— è¯Šæ–­å·¥å…· | å®Œæ•´è¯Šæ–­API |

#### ä¿®å¤æ•ˆæœéªŒè¯

**ä¿®å¤å‰çš„å…¸å‹é—®é¢˜**:
- é˜´å½±å’Œå»ºç­‘ç‰©æœ‰æ˜æ˜¾çš„ç©ºé—´åç§»
- ä¸åŒzoomçº§åˆ«é”™ä½ç¨‹åº¦ä¸ä¸€è‡´
- éƒ¨åˆ†åŒºåŸŸé˜´å½±å®Œå…¨é”™ä½

**ä¿®å¤åçš„é¢„æœŸæ•ˆæœ**:
- âœ… é˜´å½±ç²¾ç¡®è¦†ç›–å»ºç­‘ç‰©è½®å»“
- âœ… æ‰€æœ‰zoomçº§åˆ«ä¿æŒä¸€è‡´å¯¹é½
- âœ… åƒç´ çº§ç²¾åº¦çš„ç©ºé—´åŒ¹é…

### ç«‹å³æµ‹è¯•ä¿®å¤æ•ˆæœ

1. **é‡å¯å‰ç«¯åº”ç”¨**: `npm run dev` (åº”ç”¨æ–°çš„åæ ‡å¯¹é½é…ç½®)
2. **æ£€æŸ¥é”™ä½æƒ…å†µ**: `node fix-shadow-alignment.js check`
3. **éªŒè¯ç‰¹å®šä½ç½®**: `node check-alignment.js coord 39.9042 116.4074`

**å…³é”®æŒ‡æ ‡**: å¦‚æœå¯¹é½ç‡ä»å½“å‰çš„<50%æå‡åˆ°80%+ï¼Œè¯´æ˜é”™ä½é—®é¢˜åŸºæœ¬è§£å†³

### ğŸš¨ ç”¨æˆ·åé¦ˆï¼šç›´æ¥è§£å†³Mapboxå¯¹é½é—®é¢˜ (2025-01-XX)

ç”¨æˆ·æŒ‡å‡ºä¿®å¤æ–¹æ¡ˆ"è¿‡äºçº¸ä¸Šè°ˆå…µï¼Œç¼ºä¹é’ˆå¯¹æ€§"ï¼Œè¦æ±‚ç›´æ¥è§£å†³å…·ä½“é—®é¢˜ã€‚

#### ğŸ¯ é—®é¢˜ç²¾ç¡®å®šä½
**ç”¨æˆ·åé¦ˆ**: "åº•å›¾æ˜¯mapboxçš„ï¼Œå»ºç­‘ä¹Ÿæ˜¾ç¤ºåœ¨åº•å›¾ä¸Šï¼Œé˜´å½±ä¸çŸ¥é“ä¸ºä»€ä¹ˆä¼šå’Œmapboxä¸å¯¹é½"
**æµ‹è¯•ç»“æœ**: å¯¹é½ç‡0.0% (åŒ—äº¬ã€ä¸Šæµ·ã€æ·±åœ³å…¨éƒ¨é”™ä½)
**æ ¹æœ¬åŸå› **: **é˜´å½±æ¨¡æ‹Ÿå™¨ä¸Mapboxåº•å›¾åæ ‡ç³»ä¸åŒæ­¥**

#### âœ… ç›´æ¥ä¿®å¤æ–¹æ¡ˆ (é¿å…å¤æ‚åŒ–)

**æ–¹æ¡ˆ1: ç®€åŒ–éªŒè¯å·¥å…·**
åˆ›å»º`ç›´æ¥æµ‹è¯•é˜´å½±å¯¹é½.html` - å•é¡µé¢éªŒè¯å·¥å…·
```html
<!-- ğŸ”§ æœ€ç®€å•çš„æµ‹è¯•æ–¹æ³• -->
1. æ‰“å¼€æµè§ˆå™¨ localhost:5173
2. æŒ‰F12æ‰“å¼€å¼€å‘è€…å·¥å…·  
3. åœ¨Consoleè¿è¡Œ: testShadowAlignment()
4. ç›´æ¥è§‚å¯Ÿé˜´å½±æ˜¯å¦ä¸å»ºç­‘ç‰©å¯¹é½
```

**æ–¹æ¡ˆ2: Mapboxåæ ‡å¼ºåˆ¶åŒæ­¥**
```typescript
// ğŸ”§ æ ¸å¿ƒä¿®å¤ï¼šMapboxShadowSyncç±»
class MapboxShadowSync {
  forceSynchronization() {
    // ç›´æ¥åŒæ­¥Mapboxçš„å˜æ¢çŸ©é˜µåˆ°é˜´å½±æ¨¡æ‹Ÿå™¨
    this.shadeMap.syncMapTransform(this.map.transform);
  }
}
```

**æ–¹æ¡ˆ3: å®æ—¶åŒæ­¥ç›‘å¬**
```typescript
// ğŸ”§ ç›‘å¬Mapboxåœ°å›¾äº‹ä»¶ï¼Œå®æ—¶åŒæ­¥é˜´å½±
map.on('move', () => shadowSync.forceSynchronization());
map.on('zoom', () => shadowSync.forceSynchronization());  
map.on('rotate', () => shadowSync.forceSynchronization());
```

#### ğŸ¯ ç«‹å³æµ‹è¯•æ­¥éª¤ (é¿å…å…œåœˆå­)

1. **é‡å¯å‰ç«¯**: `npm run dev`
2. **æµè§ˆå™¨éªŒè¯**: 
   - æ‰“å¼€ `http://localhost:5173`
   - F12 â†’ Console â†’ è¿è¡Œ `testShadowAlignment()`
3. **è§†è§‰ç¡®è®¤**: 
   - æ‰¾ä¸€ä¸ªæ˜æ˜¾å»ºç­‘ç‰©
   - è§‚å¯Ÿé˜´å½±æ˜¯å¦åœ¨æ­£ç¡®ä½ç½®
   - ç§»åŠ¨åœ°å›¾æ£€æŸ¥é˜´å½±è·Ÿéš

#### é¢„æœŸä¿®å¤æŒ‡æ ‡

| éªŒè¯é¡¹ | ä¿®å¤å‰ | ä¿®å¤åç›®æ ‡ |
|--------|--------|------------|
| åƒç´ åç§» | >50px | <5px |
| è§†è§‰å¯¹é½ | æ˜æ˜¾é”™ä½ | ç²¾ç¡®è¦†ç›– |
| åœ°å›¾è·Ÿéš | ä¸è·Ÿéš | å®æ—¶è·Ÿéš |
| Consoleé”™è¯¯ | åæ ‡è½¬æ¢å¤±è´¥ | æ­£å¸¸å·¥ä½œ |

**æ ¸å¿ƒç›®æ ‡**: ç”¨æˆ·èƒ½ç›´è§‚çœ‹åˆ°é˜´å½±ç²¾ç¡®è¦†ç›–Mapboxä¸Šçš„å»ºç­‘ç‰©è½®å»“

#### å¦‚æœä»æœ‰é—®é¢˜çš„ç®€å•æ’æŸ¥

1. **æ’ä»¶ç‰ˆæœ¬é—®é¢˜**: æ£€æŸ¥ `mapbox-gl-shadow-simulator` æ˜¯å¦ä¸å½“å‰Mapbox GL JSå…¼å®¹
2. **åæ ‡ç³»ä¸åŒ¹é…**: ç¡®è®¤é˜´å½±æ¨¡æ‹Ÿå™¨ä½¿ç”¨ä¸Mapboxç›¸åŒçš„Web MercatoræŠ•å½±
3. **æ•°æ®æºå·®å¼‚**: éªŒè¯DEMæ•°æ®å’Œå»ºç­‘ç‰©æ•°æ®æ˜¯å¦ä½¿ç”¨ç›¸åŒçš„ç“¦ç‰‡æ ‡å‡†

**é¿å…å¤æ‚è¯Šæ–­ï¼Œä¼˜å…ˆè§†è§‰éªŒè¯å’Œç®€å•ä¿®å¤**

### ğŸ—ï¸ å»ºç­‘ç‰©æŸ¥è¯¢ç­–ç•¥å…¨é¢ä¼˜åŒ– (2025-01-XX)

ç”¨æˆ·åé¦ˆ"fastç­–ç•¥ä¼šæ¼æ‰å»ºç­‘ç‰©"ï¼Œè¦æ±‚"å°½é‡å…¨é¢åœ°è®¡ç®—è§†å›¾é‡Œé¢åœ°é˜´å½±"

#### âœ… ç­–ç•¥æ¼å»ºç­‘é—®é¢˜ç¡®è®¤
**é—®é¢˜åˆ†æ**: ä¸åŒæŸ¥è¯¢ç­–ç•¥å»ºç­‘ç±»å‹è¦†ç›–ç‡å·®å¼‚å·¨å¤§
```typescript
fastç­–ç•¥:    åªæŸ¥2ç±» (ä½å®…+å•†ä¸š) â†’ âŒ é—æ¼å­¦æ ¡ã€åŒ»é™¢ã€æ”¿åºœç­‰é‡è¦å»ºç­‘
standardç­–ç•¥: æŸ¥è¯¢6ç±»å»ºç­‘ â†’ âŒ é—æ¼å®—æ•™ã€å¨±ä¹ã€äº¤é€šå»ºç­‘  
completeç­–ç•¥: æŸ¥è¯¢60+ç±»å…¨éƒ¨å»ºç­‘ â†’ âœ… ä¸æ¼ä»»ä½•å»ºç­‘ç±»å‹
```

#### âœ… ç­–ç•¥ä¼˜å…ˆçº§å…¨é¢è°ƒæ•´
**ä¿®å¤æ–¹æ¡ˆ**: é»˜è®¤ä½¿ç”¨completeç­–ç•¥ï¼Œç¡®ä¿å®Œæ•´é˜´å½±è¦†ç›–
```typescript
// ğŸ”§ ç­–ç•¥ä¼˜å…ˆçº§é‡æ–°æ’åº
complete: { priority: 1, note: 'âœ… æŸ¥è¯¢æ‰€æœ‰60+ç§å»ºç­‘ç±»å‹ï¼Œç¡®ä¿å®Œæ•´é˜´å½±è®¡ç®—' }
standard: { priority: 2, note: 'åŒ…å«ä¸»è¦6ç±»å»ºç­‘ï¼Œä»ä¼šé—æ¼éƒ¨åˆ†å»ºç­‘' }
fast:     { priority: 3, note: 'âš ï¸ åªæŸ¥è¯¢ä½å®…å•†ä¸šï¼Œä¼šé—æ¼å­¦æ ¡åŒ»é™¢ç­‰é‡è¦å»ºç­‘' }

// ğŸ”§ æ‰€æœ‰åœ°åŸŸéƒ½é»˜è®¤ä½¿ç”¨completeç­–ç•¥
ä¸­å›½åŒºåŸŸ: preferredStrategy = 'complete' // ç¡®ä¿ä¸æ¼å»ºç­‘
æ¬§æ´²åŒºåŸŸ: preferredStrategy = 'complete' // ç¡®ä¿ä¸æ¼å»ºç­‘
åŒ—ç¾åŒºåŸŸ: preferredStrategy = 'complete' // ç¡®ä¿ä¸æ¼å»ºç­‘
å…¶ä»–åŒºåŸŸ: preferredStrategy = 'complete' // ç¡®ä¿ä¸æ¼å»ºç­‘
```

#### âœ… ç”¨æˆ·ç­–ç•¥æ§åˆ¶é¢æ¿
**æ–°å¢UI**: `BuildingQueryStrategyPanel` - ä½äºå³ä¸Šè§’"ğŸ—ï¸æŸ¥è¯¢ç­–ç•¥"æŒ‰é’®
- **ç­–ç•¥å¯¹æ¯”**: æ¸…æ™°æ˜¾ç¤º3ç§ç­–ç•¥çš„å»ºç­‘è¦†ç›–ç‡å·®å¼‚
- **æ¼å»ºç­‘è­¦å‘Š**: æ˜ç¡®æ ‡æ³¨fast/standardç­–ç•¥ä¼šé—æ¼å“ªäº›å»ºç­‘
- **ä¸€é”®åˆ‡æ¢**: ç”¨æˆ·å¯æ ¹æ®éœ€è¦é€‰æ‹©ç­–ç•¥
- **é»˜è®¤æ¨è**: ç³»ç»Ÿæ¨ècompleteç­–ç•¥ç¡®ä¿å®Œæ•´é˜´å½±

#### âœ… å»ºç­‘ç‰©ç­›é€‰æ§åˆ¶ä¼˜åŒ–  
**åŒé‡æ§åˆ¶æœºåˆ¶**:
1. **æŸ¥è¯¢ç­–ç•¥**: æ§åˆ¶ä»OSMè·å–å“ªäº›ç±»å‹çš„å»ºç­‘ (åç«¯)
2. **ç­›é€‰å¼€å…³**: æ§åˆ¶æ˜¯å¦è¿‡æ»¤å°å»ºç­‘ (å‰ç«¯ï¼Œé»˜è®¤å…³é—­)

```typescript
// ç°åœ¨çš„å®Œæ•´æµç¨‹
OSMæŸ¥è¯¢ (completeç­–ç•¥) â†’ è·å–æ‰€æœ‰60+ç±»å‹å»ºç­‘
  â†“
å‰ç«¯æ¥æ”¶ â†’ å®Œæ•´å»ºç­‘æ•°æ® 
  â†“  
å¯é€‰ç­›é€‰ (é»˜è®¤å…³é—­) â†’ ç”¨æˆ·å¯é€‰æ‹©è¿‡æ»¤å°å»ºç­‘
  â†“
é˜´å½±è®¡ç®— â†’ åŸºäºç”¨æˆ·é€‰æ‹©çš„å»ºç­‘æ•°æ®
```

### å®Œæ•´é˜´å½±è¦†ç›–æ•ˆæœå¯¹æ¯”

| ç­–ç•¥ | å»ºç­‘ç±»å‹æ•° | å…¸å‹é—æ¼å»ºç­‘ | é˜´å½±å®Œæ•´åº¦ |
|------|------------|-------------|------------|
| **fast** | 2ç±» | å­¦æ ¡ã€åŒ»é™¢ã€æ”¿åºœã€å·¥å‚ã€æ•™å ‚ | 40% âŒ |
| **standard** | 6ç±» | å®—æ•™å»ºç­‘ã€å¨±ä¹åœºæ‰€ã€äº¤é€šå»ºç­‘ | 80% âš ï¸ |
| **complete** | 60+ç±» | æ— é—æ¼ | 100% âœ… |

### ç”¨æˆ·å»ºè®®

1. **ä¿æŒé»˜è®¤**: ç³»ç»Ÿç°åœ¨é»˜è®¤ä½¿ç”¨completeç­–ç•¥ï¼Œç¡®ä¿å®Œæ•´é˜´å½±
2. **æ€§èƒ½è°ƒä¼˜**: å¦‚æœæŸ¥è¯¢è¾ƒæ…¢ï¼Œå¯åœ¨"ğŸ—ï¸æŸ¥è¯¢ç­–ç•¥"é¢æ¿é€‰æ‹©standard
3. **è§†è§‰ä¼˜åŒ–**: åœ¨"ğŸ¨é˜´å½±è´¨é‡"é¢æ¿å¯ç”¨å»ºç­‘ç­›é€‰å‡å°‘å¯†åº¦
4. **å®æ—¶è°ƒæ•´**: ä¸¤ä¸ªé¢æ¿éƒ½æ”¯æŒå®æ—¶åˆ‡æ¢ï¼Œç«‹å³ç”Ÿæ•ˆ

**æ ¸å¿ƒæ”¹è¿›**: ä»"æ€§èƒ½ä¼˜å…ˆå¯èƒ½æ¼å»ºç­‘"è½¬ä¸º"å®Œæ•´è¦†ç›–ä¼˜å…ˆï¼Œç”¨æˆ·å¯é€‰æ€§èƒ½"

### ğŸ¨ UIç•Œé¢å…¨é¢ä¼˜åŒ– (2025-01-XX)

ç”¨æˆ·åé¦ˆ"é¢æ¿è®¾è®¡åœ°éå¸¸æ‹‰è·¨ï¼Œèƒ½ä¸èƒ½è®¾è®¡çš„ç®€æ´ä¼˜é›…ä¸€ç‚¹ï¼Ÿä½ è¿™æ ·ï¼Œæˆ‘è¿æŒ‰é’®éƒ½æ²¡æ³•æ‰¾"

#### âœ… Bugä¿®å¤ï¼šheightMapTexæœªå®šä¹‰é”™è¯¯
**é—®é¢˜**: `TypeError: cannot destructure property "heightMapTex" of undefined`
```typescript
// ğŸš¨ é”™è¯¯åŸå› ï¼šåœ¨heightMapTexæœªåˆå§‹åŒ–æ—¶è°ƒç”¨_draw()æ–¹æ³•
this.shadeMap._draw(); // å¯¼è‡´heightMapTexè§£æ„å¤±è´¥

// âœ… ä¿®å¤æ–¹æ¡ˆï¼šå®‰å…¨æ£€æŸ¥heightMapTexçŠ¶æ€
if (this.shadeMap._heightMapTex || this.shadeMap.heightMapTex) {
  this.shadeMap._draw();
} else {
  console.warn('âš ï¸ heightMapTexæœªåˆå§‹åŒ–ï¼Œè·³è¿‡_drawè°ƒç”¨');
}
```

#### âœ… UIè®¾è®¡å…¨é¢é‡æ„
**é—®é¢˜**: å¤šä¸ªåˆ†æ•£çš„æ§åˆ¶é¢æ¿ï¼Œç”¨æˆ·éš¾ä»¥æ‰¾åˆ°æŒ‰é’®

**ä¿®å¤æ–¹æ¡ˆ**: åˆ›å»ºç»Ÿä¸€ç®€æ´çš„`CompactControlPanel`
```typescript
// ğŸ¨ æ–°çš„UIè®¾è®¡ç‰¹ç‚¹
- å•ä¸€ä¸»æŒ‰é’®: å³ä¸Šè§’"ğŸ¨"å›¾æ ‡ï¼Œæ¸…æ™°å¯è§
- æ ‡ç­¾å¼åˆ‡æ¢: é˜´å½±/å»ºç­‘/ç­–ç•¥ä¸‰ä¸ªæ ‡ç­¾é¡µ
- çŠ¶æ€æŒ‡ç¤ºå™¨: å°åœ†ç‚¹æ˜¾ç¤ºå½“å‰è®¾ç½®çŠ¶æ€
- ç´§å‡‘å¸ƒå±€: 320pxå®½åº¦ï¼Œé¿å…é®æŒ¡åœ°å›¾
- ç›´è§‚æ“ä½œ: æ»‘å—ã€é¢œè‰²é€‰æ‹©å™¨ã€å¿«é€Ÿé¢„è®¾
```

#### âœ… åŠŸèƒ½æ•´åˆä¼˜åŒ–
**åŸè®¾è®¡é—®é¢˜**: 3ä¸ªç‹¬ç«‹é¢æ¿åˆ†æ•£åœ¨ç•Œé¢å„å¤„
- ShadowQualityPanel (é˜´å½±è´¨é‡)
- BuildingQueryStrategyPanel (æŸ¥è¯¢ç­–ç•¥) 
- WindowsOptimizedControls (ç³»ç»Ÿæ§åˆ¶)

**æ–°è®¾è®¡ä¼˜åŠ¿**: 1ä¸ªç»Ÿä¸€é¢æ¿æ•´åˆæ‰€æœ‰åŠŸèƒ½
```typescript
// ğŸ¯ é˜´å½±æ ‡ç­¾: é€æ˜åº¦ã€é¢œè‰²ã€è‡ªåŠ¨ä¼˜åŒ–ã€å¿«é€Ÿé¢„è®¾
// ğŸ—ï¸ å»ºç­‘æ ‡ç­¾: ç­›é€‰å¼€å…³ã€æ˜¾ç¤ºæ¨¡å¼é€‰æ‹©
// âš™ï¸ ç­–ç•¥æ ‡ç­¾: å½“å‰ç­–ç•¥æ˜¾ç¤ºã€è¦†ç›–ç‡è¯´æ˜
```

#### âœ… ç”¨æˆ·ä½“éªŒæå‡
**è§†è§‰æ”¹è¿›**:
- åœ†è§’è®¾è®¡ (rounded-xl)
- æŸ”å’Œé˜´å½± (shadow-xl)
- çŠ¶æ€æŒ‡ç¤ºå™¨ (å°åœ†ç‚¹)
- å“åº”å¼æ‚¬åœæ•ˆæœ

**äº¤äº’æ”¹è¿›**:
- ä¸€é”®åˆ‡æ¢é¢æ¿
- æ ‡ç­¾é¡µå¿«é€Ÿå¯¼èˆª
- æ»‘å—å®æ—¶è°ƒèŠ‚
- å¿«é€Ÿé¢„è®¾æŒ‰é’®

**ä¿¡æ¯æ¶æ„**:
- é‡è¦ä¿¡æ¯çªå‡ºæ˜¾ç¤º
- å½“å‰çŠ¶æ€æ¸…æ™°æ ‡æ³¨
- æ“ä½œè¯´æ˜ç®€æ´æ˜äº†
- é¿å…ä¿¡æ¯è¿‡è½½

### æ–°UIç•Œé¢æ•ˆæœ

| ç‰¹æ€§ | åŸè®¾è®¡ | æ–°è®¾è®¡ |
|------|--------|--------|
| **æŒ‰é’®æ•°é‡** | 3ä¸ªåˆ†æ•£æŒ‰é’® | 1ä¸ªä¸»æŒ‰é’® âœ… |
| **é¢æ¿æ•°é‡** | 3ä¸ªç‹¬ç«‹é¢æ¿ | 1ä¸ªç»Ÿä¸€é¢æ¿ âœ… |
| **æŸ¥æ‰¾éš¾åº¦** | éš¾ä»¥æ‰¾åˆ°æŒ‰é’® | å³ä¸Šè§’æ˜æ˜¾å¯è§ âœ… |
| **æ“ä½œå¤æ‚åº¦** | éœ€è¦åˆ‡æ¢å¤šä¸ªé¢æ¿ | æ ‡ç­¾é¡µå†…åˆ‡æ¢ âœ… |
| **è§†è§‰ä¸€è‡´æ€§** | æ ·å¼ä¸ç»Ÿä¸€ | ç»Ÿä¸€è®¾è®¡è¯­è¨€ âœ… |
| **ä¿¡æ¯å¯†åº¦** | ä¿¡æ¯è¿‡è½½ | åˆ†å±‚å±•ç¤º âœ… |

### ç”¨æˆ·åé¦ˆè§£å†³

1. **"é¢æ¿è®¾è®¡åœ°éå¸¸æ‹‰è·¨"** â†’ é‡æ–°è®¾è®¡ä¸ºç®€æ´ä¼˜é›…çš„ç°ä»£UI
2. **"è¿æŒ‰é’®éƒ½æ²¡æ³•æ‰¾"** â†’ ç»Ÿä¸€ä¸ºå³ä¸Šè§’æ˜æ˜¾çš„ä¸»æŒ‰é’®
3. **heightMapTexé”™è¯¯** â†’ å¢åŠ å®‰å…¨æ£€æŸ¥ï¼Œé¿å…å´©æºƒ
4. **æ“ä½œå¤æ‚** â†’ æ ‡ç­¾é¡µè®¾è®¡ï¼ŒåŠŸèƒ½åˆ†ç±»æ¸…æ™°

**æ ¸å¿ƒæ”¹è¿›**: ä»"åŠŸèƒ½åˆ†æ•£ã€éš¾ä»¥ä½¿ç”¨"è½¬ä¸º"ç»Ÿä¸€ç•Œé¢ã€ç®€æ´ä¼˜é›…"

### â° æ—¶é—´è½´UIå…¨é¢é‡æ„ (2025-01-XX)

ç”¨æˆ·åé¦ˆ"ä¸ºä»€ä¹ˆæˆ‘çš„appæ‹–æ‹½äº†å‡ ä¸‹å°±ä¼šè·³åˆ°å…¨éƒ¨éƒ½æ˜¯é˜´å½±åœ°çŠ¶æ€ï¼Ÿæ˜¯ç›´æ¥åŒæ­¥åˆ°ç°åœ¨æ—¶åˆ»å˜›ï¼Ÿç°åœ¨ç®—æ˜¯è¿™è¾¹åœ°æ™šä¸Šã€‚æ€ä¹ˆé˜»æ­¢å®ƒè‡ªåŠ¨è·³è½¬ï¼Ÿè€Œä¸”æ—¶é—´è½´åœ°uiè®¾è®¡ä¹Ÿéå¸¸è„‘ç˜«ã€‚ä»å…ƒç´ ä¸Šéå¸¸ä½çº§ï¼Œä»å¸ƒå±€ä¸Šé˜²åˆ°äº†é¡µé¢åœ°ä¸­é—´ã€‚"

#### âœ… ä¿®å¤è‡ªåŠ¨æ—¶é—´è·³è½¬é—®é¢˜
**é—®é¢˜**: æ‹–æ‹½åœ°å›¾æ—¶è‡ªåŠ¨åŒæ­¥åˆ°å½“å‰æ—¶é—´ï¼Œå¯¼è‡´é˜´å½±è·³åˆ°æ™šä¸ŠçŠ¶æ€
```typescript
// ğŸš¨ é—®é¢˜åŸå› ï¼šåº”ç”¨å¯åŠ¨æ—¶è‡ªåŠ¨è®¾ç½®ä¸ºå½“å‰æ—¶é—´
currentDate: new Date(), // æ¯æ¬¡å¯åŠ¨éƒ½æ˜¯å½“å‰æ—¶é—´

// âœ… ä¿®å¤æ–¹æ¡ˆï¼šè®¾ç½®å›ºå®šé»˜è®¤æ—¶é—´
currentDate: new Date(2024, 0, 1, 12, 0, 0), // é»˜è®¤ä¸­åˆ12ç‚¹ï¼Œé¿å…è‡ªåŠ¨è·³è½¬
```

#### âœ… æ—¶é—´è½´UIè®¾è®¡å…¨é¢é‡æ„
**é—®é¢˜**: "æ—¶é—´è½´åœ°uiè®¾è®¡ä¹Ÿéå¸¸è„‘ç˜«ã€‚ä»å…ƒç´ ä¸Šéå¸¸ä½çº§ï¼Œä»å¸ƒå±€ä¸Šé˜²åˆ°äº†é¡µé¢åœ°ä¸­é—´"

**åŸè®¾è®¡é—®é¢˜**:
- âŒ å æ®é¡µé¢ä¸­é—´ï¼Œé®æŒ¡åœ°å›¾å†…å®¹
- âŒ å…ƒç´ è®¾è®¡ä½çº§ï¼Œä¸å¤Ÿç°ä»£
- âŒ åŠŸèƒ½å¤æ‚ï¼Œä¿¡æ¯è¿‡è½½
- âŒ å¸ƒå±€ä¸åˆç†ï¼Œå½±å“ä½¿ç”¨ä½“éªŒ

**æ–°è®¾è®¡ä¼˜åŠ¿**:
```typescript
// ğŸ¨ æ–°çš„æ—¶é—´è½´è®¾è®¡ç‰¹ç‚¹
- ç´§å‡‘æ¨¡å¼: å³ä¸‹è§’å°é¢æ¿ï¼Œä¸é®æŒ¡åœ°å›¾
- å±•å¼€æ¨¡å¼: éœ€è¦æ—¶å±•å¼€ï¼Œè¯¦ç»†æ§åˆ¶
- ç°ä»£è®¾è®¡: æ¯›ç»ç’ƒæ•ˆæœã€åœ†è§’ã€é˜´å½±
- ç›´è§‚æ“ä½œ: å›¾æ ‡æ¸…æ™°ã€çŠ¶æ€æ˜ç¡®
- æ‰‹åŠ¨åŒæ­¥: æä¾›ğŸ”„æŒ‰é’®æ‰‹åŠ¨åŒæ­¥åˆ°å½“å‰æ—¶é—´
```

#### âœ… ç”¨æˆ·ä½“éªŒä¼˜åŒ–
**å¸ƒå±€æ”¹è¿›**:
- ä»é¡µé¢ä¸­é—´ â†’ å³ä¸‹è§’å›ºå®šä½ç½®
- ä»å¤§å‹é¢æ¿ â†’ ç´§å‡‘æ¨¡å¼ + å¯é€‰å±•å¼€
- ä»é®æŒ¡åœ°å›¾ â†’ æ‚¬æµ®è®¾è®¡ï¼Œä¸å½±å“åœ°å›¾æŸ¥çœ‹

**äº¤äº’æ”¹è¿›**:
- é»˜è®¤ç´§å‡‘æ¨¡å¼ï¼Œéœ€è¦æ—¶å±•å¼€
- ä¸€é”®åŒæ­¥åˆ°å½“å‰æ—¶é—´ï¼ˆæ‰‹åŠ¨æ§åˆ¶ï¼‰
- å¿«é€Ÿæ—¶é—´é€‰æ‹©ï¼ˆæ—¥å‡ºã€æ­£åˆã€æ—¥è½ã€åˆå¤œï¼‰
- æ’­æ”¾/æš‚åœæ§åˆ¶æ›´åŠ ç›´è§‚

**è§†è§‰æ”¹è¿›**:
- æ¯›ç»ç’ƒèƒŒæ™¯æ•ˆæœ
- åœ†è§’è®¾è®¡è¯­è¨€
- çŠ¶æ€æŒ‡ç¤ºå™¨ï¼ˆå°åœ†ç‚¹ï¼‰
- æ¸å˜è‰²å½©æ­é…

### æ—¶é—´è½´å¯¹æ¯”æ•ˆæœ

| ç‰¹æ€§ | åŸè®¾è®¡ | æ–°è®¾è®¡ |
|------|--------|--------|
| **ä½ç½®** | é¡µé¢ä¸­é—´ï¼Œé®æŒ¡åœ°å›¾ âŒ | å³ä¸‹è§’ï¼Œæ‚¬æµ®è®¾è®¡ âœ… |
| **å¤§å°** | å¤§å‹é¢æ¿ï¼Œå ç”¨ç©ºé—´ âŒ | ç´§å‡‘æ¨¡å¼ï¼Œå¯é€‰å±•å¼€ âœ… |
| **è®¾è®¡** | å…ƒç´ ä½çº§ï¼Œä¸å¤Ÿç°ä»£ âŒ | æ¯›ç»ç’ƒæ•ˆæœï¼Œç°ä»£è®¾è®¡ âœ… |
| **è‡ªåŠ¨åŒæ­¥** | è‡ªåŠ¨è·³è½¬åˆ°å½“å‰æ—¶é—´ âŒ | æ‰‹åŠ¨æ§åˆ¶ï¼Œé»˜è®¤ä¸­åˆ âœ… |
| **æ“ä½œ** | å¤æ‚ï¼Œä¿¡æ¯è¿‡è½½ âŒ | ç®€æ´ç›´è§‚ï¼Œå¿«é€Ÿæ“ä½œ âœ… |
| **åœ°å›¾å½±å“** | ä¸¥é‡é®æŒ¡åœ°å›¾å†…å®¹ âŒ | ä¸å½±å“åœ°å›¾æŸ¥çœ‹ âœ… |

### ç”¨æˆ·é—®é¢˜è§£å†³

1. **"æ‹–æ‹½å‡ ä¸‹å°±ä¼šè·³åˆ°å…¨éƒ¨éƒ½æ˜¯é˜´å½±"** â†’ ä¿®å¤è‡ªåŠ¨æ—¶é—´åŒæ­¥ï¼Œé»˜è®¤ä¸­åˆ12ç‚¹
2. **"ç›´æ¥åŒæ­¥åˆ°ç°åœ¨æ—¶åˆ»"** â†’ æ”¹ä¸ºæ‰‹åŠ¨åŒæ­¥ï¼Œæä¾›ğŸ”„æŒ‰é’®
3. **"æ€ä¹ˆé˜»æ­¢å®ƒè‡ªåŠ¨è·³è½¬"** â†’ å®Œå…¨é˜»æ­¢è‡ªåŠ¨è·³è½¬ï¼Œç”¨æˆ·ä¸»åŠ¨æ§åˆ¶
4. **"æ—¶é—´è½´åœ°uiè®¾è®¡ä¹Ÿéå¸¸è„‘ç˜«"** â†’ é‡æ–°è®¾è®¡ä¸ºç°ä»£ç®€æ´é£æ ¼
5. **"ä»å…ƒç´ ä¸Šéå¸¸ä½çº§"** â†’ é‡‡ç”¨ç°ä»£è®¾è®¡è¯­è¨€ï¼Œæ¯›ç»ç’ƒæ•ˆæœ
6. **"ä»å¸ƒå±€ä¸Šé˜²åˆ°äº†é¡µé¢åœ°ä¸­é—´"** â†’ ç§»è‡³å³ä¸‹è§’ï¼Œæ‚¬æµ®è®¾è®¡

### ä½¿ç”¨æ–¹å¼

1. **ç´§å‡‘æ¨¡å¼**ï¼ˆé»˜è®¤ï¼‰:
   - å³ä¸‹è§’æ˜¾ç¤ºå½“å‰æ—¶é—´å’Œæ’­æ”¾æ§åˆ¶
   - ç‚¹å‡»ğŸ”„æ‰‹åŠ¨åŒæ­¥åˆ°å½“å‰æ—¶é—´
   - ç‚¹å‡»â°å±•å¼€è¯¦ç»†æ§åˆ¶

2. **å±•å¼€æ¨¡å¼**:
   - è¯¦ç»†çš„æ—¶é—´è½´å’Œå¿«é€Ÿæ—¶é—´é€‰æ‹©
   - æ’­æ”¾é€Ÿåº¦æ§åˆ¶
   - æ—¥å‡ºã€æ­£åˆã€æ—¥è½ã€åˆå¤œå¿«é€ŸæŒ‰é’®

**æ ¸å¿ƒæ”¹è¿›**: ä»"è‡ªåŠ¨è·³è½¬ã€å¸ƒå±€ç³Ÿç³•"è½¬ä¸º"æ‰‹åŠ¨æ§åˆ¶ã€ç®€æ´ä¼˜é›…"

---

## ğŸ“ˆ é¡¹ç›®å¼€å‘é‡Œç¨‹ç¢‘æ€»ç»“ (2025-01-XX)

### ğŸ¯ ç¬¬ä¸€é˜¶æ®µï¼šåŸºç¡€æ¶æ„æ­å»º (å·²å®Œæˆ)
**æ—¶é—´**: é¡¹ç›®å¯åŠ¨ - 2024å¹´åº•
**æ ¸å¿ƒæˆæœ**:
- âœ… å‰åç«¯åˆ†ç¦»æ¶æ„ï¼šReact + Node.js + MongoDB
- âœ… åœ°å›¾å¼•æ“é›†æˆï¼šLeaflet + Mapbox GL + é˜´å½±æ¨¡æ‹Ÿå™¨
- âœ… æ•°æ®æºæ•´åˆï¼šAWS DEM + OSMå»ºç­‘ç‰© + TUMæ•°æ®
- âœ… åŸºç¡€UIæ¡†æ¶ï¼šTailwind CSS + ç°ä»£åŒ–è®¾è®¡

### ğŸ”§ ç¬¬äºŒé˜¶æ®µï¼šæ ¸å¿ƒåŠŸèƒ½å®ç° (å·²å®Œæˆ)
**æ—¶é—´**: 2025å¹´1æœˆåˆ - ä¸­æ—¬
**æ ¸å¿ƒæˆæœ**:
- âœ… **é˜´å½±è®¡ç®—ç³»ç»Ÿ**: å®æ—¶é˜´å½±æ¨¡æ‹Ÿï¼Œæ”¯æŒæ—¶é—´æ§åˆ¶
- âœ… **æ•°æ®ç¼“å­˜æ¶æ„**: Redis + MongoDB + OSMä¸‰çº§ç¼“å­˜
- âœ… **å»ºç­‘ç‰©æŸ¥è¯¢ä¼˜åŒ–**: 60+ç§å»ºç­‘ç±»å‹ï¼Œæ™ºèƒ½æŸ¥è¯¢ç­–ç•¥
- âœ… **æ€§èƒ½ä¼˜åŒ–ç³»ç»Ÿ**: é˜²æŠ–è®¡ç®—ï¼Œæ¸è¿›å¼åŠ è½½ï¼Œé”™è¯¯é‡è¯•

### ğŸ¨ ç¬¬ä¸‰é˜¶æ®µï¼šç”¨æˆ·ä½“éªŒä¼˜åŒ– (å·²å®Œæˆ)
**æ—¶é—´**: 2025å¹´1æœˆä¸­æ—¬ - ä¸‹æ—¬
**æ ¸å¿ƒæˆæœ**:
- âœ… **UIè®¾è®¡é‡æ„**: å­¦ä¹ shademap.appï¼Œå®ç°ç®€æ´ä¼˜é›…ç•Œé¢
- âœ… **CleanShadowMapç»„ä»¶**: æ‰‹åŠ¨æ§åˆ¶æµç¨‹ï¼ŒçŠ¶æ€æŒ‡ç¤ºæ¸…æ™°
- âœ… **é˜´å½±è´¨é‡æ§åˆ¶**: åŠ¨æ€é€æ˜åº¦ã€é¢œè‰²è°ƒæ•´ï¼Œå»ºç­‘ç­›é€‰
- âœ… **æ—¶é—´è½´ä¼˜åŒ–**: æ‚¬æµ®è®¾è®¡ï¼Œé¿å…é®æŒ¡ï¼Œæ‰‹åŠ¨æ—¶é—´åŒæ­¥

### ğŸš§ ç¬¬å››é˜¶æ®µï¼šé—®é¢˜ä¿®å¤ä¸ä¼˜åŒ– (è¿›è¡Œä¸­)
**æ—¶é—´**: 2025å¹´1æœˆä¸‹æ—¬ - ç°åœ¨
**å½“å‰è¿›å±•**:
- ğŸ”„ **é˜´å½±å¯¹é½é—®é¢˜**: éƒ¨åˆ†è§£å†³ï¼Œä»éœ€ç²¾åº¦ä¼˜åŒ–
- ğŸ”„ **ç”¨æˆ·ä½“éªŒç»†èŠ‚**: æŒ‰é’®å¯è§æ€§ï¼Œäº¤äº’æµç•…åº¦æ”¹è¿›
- ğŸ”„ **ç¼“å­˜ç­–ç•¥ä¼˜åŒ–**: åŸºäºTUMæ•°æ®ç‰¹ç‚¹çš„é•¿æœŸç¼“å­˜æ–¹æ¡ˆ
- ğŸ”„ **é”™è¯¯å¤„ç†å®Œå–„**: ç½‘ç»œå¼‚å¸¸ã€æ•°æ®ç¼ºå¤±çš„ç”¨æˆ·å‹å¥½æç¤º

### ğŸ“Š å¼€å‘æˆæœç»Ÿè®¡
- **ä»£ç æäº¤**: 100+ commits
- **æ ¸å¿ƒç»„ä»¶**: 15+ Reactç»„ä»¶
- **APIç«¯ç‚¹**: 20+ RESTfulæ¥å£
- **æ•°æ®åº“é›†åˆ**: 5ä¸ªMongoDBé›†åˆ
- **ç¼“å­˜å±‚çº§**: 3çº§ç¼“å­˜æ¶æ„
- **å»ºç­‘ç±»å‹æ”¯æŒ**: 60+ OSMå»ºç­‘ç±»å‹
- **æ€§èƒ½æå‡**: 70%è®¡ç®—ä¼˜åŒ–ï¼Œ90%+APIæˆåŠŸç‡

### ğŸ¯ æŠ€æœ¯çªç ´ç‚¹
1. **ä¸‰çº§ç¼“å­˜æ¶æ„**: å®ç°æ¯«ç§’çº§æ•°æ®è®¿é—®
2. **æ™ºèƒ½æŸ¥è¯¢ç­–ç•¥**: æ ¹æ®åœ°åŸŸè‡ªåŠ¨ä¼˜åŒ–æŸ¥è¯¢å‚æ•°
3. **é˜´å½±è´¨é‡æ§åˆ¶**: åŠ¨æ€è°ƒæ•´æ¸²æŸ“å‚æ•°ï¼Œå¹³è¡¡è´¨é‡ä¸æ€§èƒ½
4. **å‚è€ƒè®¾è®¡å­¦ä¹ **: æˆåŠŸå¤ç°ä¸“ä¸šé˜´å½±åˆ†æå·¥å…·çš„ç”¨æˆ·ä½“éªŒ

---

### ğŸ¨ å‚è€ƒç½‘ç«™UIè®¾è®¡å­¦ä¹ ä¸å®ç° (2025-01-XX)

ç”¨æˆ·è¦æ±‚"è¿™æ˜¯æˆ‘ä»¬è¦æ¨¡ä»¿åœ°ç½‘ç«™ï¼Œå®ƒåœ°åº•å›¾æ˜¯ä»€ä¹ˆï¼Ÿè€Œä¸”å®ƒçš„uiè®¾è®¡æˆ‘ä»¬åº”è¯¥å­¦ä¹ ä¸‹"

#### âœ… å‚è€ƒç½‘ç«™åˆ†æ
**åº•å›¾ç‰¹å¾**:
- **Mapbox Streets æˆ–ç±»ä¼¼çŸ¢é‡åœ°å›¾**: æ¸…æ™°çº¿æ¡ï¼Œæµ…è‰²é…è‰²
- **åŒè¯­æ ‡ç­¾**: ä¸­è‹±æ–‡é“è·¯åç§°
- **å»ºç­‘ç‰©è½®å»“**: æµ…ç°è‰²å»ºç­‘å¤šè¾¹å½¢
- **æ°´ç³»**: è“è‰²æ²³æµæ¹–æ³Š
- **ç»¿åœ°**: æ·±ç»¿è‰²å…¬å›­åŒºåŸŸ

**UIè®¾è®¡ç‰¹ç‚¹**:
- **é¡¶éƒ¨æœç´¢æ **: ç®€æ´æœç´¢æ¡† + å‘é€æŒ‰é’® + æ±‰å ¡èœå•
- **å³ä¾§æ§åˆ¶é¢æ¿**: å‚ç›´æ’åˆ—ï¼Œæ‚¬æµ®è®¾è®¡ï¼Œå›¾æ ‡æ¸…æ™°
- **åº•éƒ¨æ—¶é—´è½´**: æ°´å¹³æ—¶é—´è½´ + å¤ªé˜³å‚æ•°æ˜¾ç¤º

#### âœ… å­¦ä¹ å‚è€ƒç½‘ç«™çš„è®¾è®¡ç†å¿µ
**è®¾è®¡åŸåˆ™**:
```typescript
// ğŸ¨ å‚è€ƒç½‘ç«™çš„è®¾è®¡ä¼˜åŠ¿
1. ç®€æ´æ€§: ç•Œé¢å…ƒç´ æœ€å°‘åŒ–ï¼ŒåŠŸèƒ½æ˜ç¡®
2. ä¸“ä¸šæ€§: å¤ªé˜³å‚æ•°æ˜¾ç¤ºï¼Œç§‘å­¦æ„Ÿå¼º
3. ç©ºé—´åˆ©ç”¨: ä¸é®æŒ¡åœ°å›¾ï¼Œæ‚¬æµ®è®¾è®¡
4. ä¿¡æ¯å¯†åº¦: é‡è¦ä¿¡æ¯çªå‡ºï¼Œæ¬¡è¦ä¿¡æ¯éšè—
5. äº¤äº’é€»è¾‘: ç‚¹å‡»å±•å¼€ï¼Œé¿å…ç•Œé¢æ··ä¹±
```

#### âœ… å®ç°å‚è€ƒç½‘ç«™é£æ ¼çš„UIç»„ä»¶
**æ–°å¢ç»„ä»¶**:

1. **ReferenceInspiredSearch** - é¡¶éƒ¨æœç´¢æ 
```typescript
// ğŸ” å‚è€ƒç½‘ç«™çš„æœç´¢è®¾è®¡
- æ±‰å ¡èœå•: â˜° å›¾æ ‡
- æœç´¢æ¡†: "æœç´¢åœ°ç‚¹..." placeholder
- å‘é€æŒ‰é’®: ğŸ“¤ å›¾æ ‡
- æ¯›ç»ç’ƒæ•ˆæœ: backdrop-blur-sm
```

2. **ReferenceInspiredControls** - å³ä¾§æ§åˆ¶é¢æ¿
```typescript
// ğŸ›ï¸ å‚è€ƒç½‘ç«™çš„æ§åˆ¶è®¾è®¡
- å‚ç›´æ’åˆ—: èŠ‚çœæ°´å¹³ç©ºé—´
- æ‚¬æµ®å±•å¼€: ç‚¹å‡»å±•å¼€è¯¦ç»†æ§åˆ¶
- åŠŸèƒ½åˆ†ç»„: æœç´¢ã€å›¾å±‚ã€3Dã€ç¼©æ”¾ã€ä¿¡æ¯
- é˜´å½±è´¨é‡: å¿«é€Ÿé¢„è®¾æŒ‰é’®
```

3. **ReferenceInspiredTimeline** - åº•éƒ¨æ—¶é—´è½´
```typescript
// â° å‚è€ƒç½‘ç«™çš„æ—¶é—´è½´è®¾è®¡
- æ°´å¹³æ—¶é—´è½´: 6æ—¶-23æ—¶ï¼Œæ¸…æ™°æ•°å­—æ˜¾ç¤º
- å¤ªé˜³å‚æ•°: é«˜åº¦è§’ã€æ–¹ä½è§’ã€æ–¹å‘
- ä¸“ä¸šæ˜¾ç¤º: "å¤ªé˜³é«˜åº¦: 28.9Â° æ–¹ä½è§’: 248.8Â° WSW"
- æ’­æ”¾æ§åˆ¶: å³ä¾§æ’­æ”¾æŒ‰é’®å’Œé€Ÿåº¦é€‰æ‹©
```

#### âœ… UIè®¾è®¡å¯¹æ¯”

| ç‰¹æ€§ | åŸè®¾è®¡ | å‚è€ƒç½‘ç«™é£æ ¼ | æ”¹è¿›æ•ˆæœ |
|------|--------|-------------|----------|
| **æœç´¢æ ** | æ— ç‹¬ç«‹æœç´¢ | é¡¶éƒ¨ä¸“ç”¨æœç´¢æ  âœ… | åŠŸèƒ½æ˜ç¡®ï¼Œæ˜“äºå‘ç° |
| **æ§åˆ¶é¢æ¿** | å¤§å‹é¢æ¿ | å‚ç›´æ‚¬æµ®æ§åˆ¶ âœ… | èŠ‚çœç©ºé—´ï¼Œä¸é®æŒ¡åœ°å›¾ |
| **æ—¶é—´è½´** | å³ä¸‹è§’å°é¢æ¿ | åº•éƒ¨æ°´å¹³æ—¶é—´è½´ âœ… | ä¸“ä¸šæ„Ÿå¼ºï¼Œä¿¡æ¯ä¸°å¯Œ |
| **ä¿¡æ¯æ˜¾ç¤º** | åŸºç¡€æ—¶é—´ | å¤ªé˜³å‚æ•°æ˜¾ç¤º âœ… | ç§‘å­¦ä¸“ä¸šï¼ŒæŠ€æœ¯æ„Ÿå¼º |
| **ç©ºé—´åˆ©ç”¨** | ç•Œé¢æ‹¥æŒ¤ | æ‚¬æµ®è®¾è®¡ âœ… | åœ°å›¾å¯è§†åŒºåŸŸæœ€å¤§åŒ– |

#### âœ… å¤ªé˜³å‚æ•°è®¡ç®—
**æ–°å¢ä¸“ä¸šåŠŸèƒ½**:
```typescript
// ğŸŒ å¤ªé˜³ä½ç½®è®¡ç®—ï¼ˆåŸºäºåŒ—äº¬çº¬åº¦39.9Â°ï¼‰
const calculateSunPosition = (date: Date) => {
  // å¤ªé˜³é«˜åº¦è§’è®¡ç®—
  // å¤ªé˜³æ–¹ä½è§’è®¡ç®—  
  // æ–¹å‘æ ‡è¯† (N, NNE, NE, ...)
  return {
    elevation: "28.9Â°",    // å¤ªé˜³é«˜åº¦è§’
    azimuth: "248.8Â°",     // æ–¹ä½è§’
    direction: "WSW"       // æ–¹å‘æ ‡è¯†
  };
};
```

#### âœ… ç”¨æˆ·ä½“éªŒæå‡
**äº¤äº’æ”¹è¿›**:
- **æœç´¢åŠŸèƒ½**: ä¸“ç”¨æœç´¢æ ï¼Œæ”¯æŒåœ°ç‚¹æœç´¢
- **æ§åˆ¶å±•å¼€**: ç‚¹å‡»æ§åˆ¶æŒ‰é’®å±•å¼€è¯¦ç»†é€‰é¡¹
- **ä¸“ä¸šæ˜¾ç¤º**: å¤ªé˜³å‚æ•°å®æ—¶è®¡ç®—å’Œæ˜¾ç¤º
- **å¿«é€Ÿæ“ä½œ**: é˜´å½±è´¨é‡ä¸€é”®é¢„è®¾

**è§†è§‰æ”¹è¿›**:
- **æ¯›ç»ç’ƒæ•ˆæœ**: backdrop-blur-sm ç°ä»£æ„Ÿ
- **æ‚¬æµ®è®¾è®¡**: ä¸é®æŒ¡åœ°å›¾å†…å®¹
- **ä¸“ä¸šé…è‰²**: è“è‰²ä¸»è‰²è°ƒï¼Œæ©™è‰²å¼ºè°ƒè‰²
- **ä¿¡æ¯å±‚æ¬¡**: é‡è¦ä¿¡æ¯çªå‡ºæ˜¾ç¤º

### è®¾è®¡å­¦ä¹ æ€»ç»“

1. **ç®€æ´æ€§åŸåˆ™**: ç•Œé¢å…ƒç´ æœ€å°‘åŒ–ï¼ŒåŠŸèƒ½æ˜ç¡®
2. **ä¸“ä¸šæ€§ä½“ç°**: å¤ªé˜³å‚æ•°ç­‰ç§‘å­¦æ•°æ®å±•ç¤º
3. **ç©ºé—´åˆ©ç”¨**: æ‚¬æµ®è®¾è®¡ï¼Œæœ€å¤§åŒ–åœ°å›¾å¯è§†åŒºåŸŸ
4. **äº¤äº’é€»è¾‘**: ç‚¹å‡»å±•å¼€ï¼Œé¿å…ç•Œé¢æ··ä¹±
5. **ä¿¡æ¯å¯†åº¦**: é‡è¦ä¿¡æ¯çªå‡ºï¼Œæ¬¡è¦ä¿¡æ¯éšè—

**æ ¸å¿ƒæ”¹è¿›**: ä»"åŠŸèƒ½å¯¼å‘"è½¬ä¸º"ä¸“ä¸šç®€æ´"ï¼Œå­¦ä¹ ä¼˜ç§€ç½‘ç«™çš„è®¾è®¡ç†å¿µ

### ğŸ™ï¸ åŒ—äº¬æ•°æ®é¢„å¤„ç†Caseå®ç° (2025-01-XX)

ç”¨æˆ·è¦æ±‚"æˆ‘è§‰å¾—å¯ä»¥å…ˆä»¥åŒ—äº¬ä½œä¸ºä¸€ä¸ªcaseï¼ŒæŠŠæ•°æ®å’Œä¸šåŠ¡ç»™è·‘é€š"

#### âœ… æ•°æ®åº“è¿æ¥é”™è¯¯ä¿®å¤
**é—®é¢˜**: `TypeError: (0 , database_1.connectDatabase) is not a function`
**åŸå› **: `preloadBuildingData.ts`å¯¼å…¥çš„æ˜¯`connectDatabase`å‡½æ•°ï¼Œä½†å®é™…å¯¼å‡ºçš„æ˜¯`DatabaseManager`ç±»
**ä¿®å¤æ–¹æ¡ˆ**:
```typescript
// ğŸš¨ é”™è¯¯çš„å¯¼å…¥
import { connectDatabase } from '../config/database';
await connectDatabase();

// âœ… æ­£ç¡®çš„å¯¼å…¥
import { dbManager } from '../config/database';
await dbManager.connect();
```

#### âœ… åŒ—äº¬ä¸“ç”¨é¢„å¤„ç†è„šæœ¬
**æ–°å¢å·¥å…·**: `preload-beijing.js` - ä¸“é—¨é’ˆå¯¹åŒ—äº¬åœ°åŒºçš„æ•°æ®é¢„å¤„ç†
```bash
# åŒ—äº¬æ•°æ®é¢„å¤„ç†å®Œæ•´æµç¨‹
node preload-beijing.js

# åŠŸèƒ½ç‰¹ç‚¹:
# 1. æ£€æŸ¥åç«¯æœåŠ¡çŠ¶æ€
# 2. é¢„å¤„ç†åŒ—äº¬æ ¸å¿ƒåŒºåŸŸ (39.9042, 116.4074, radius=5)
# 3. ç­‰å¾…é¢„å¤„ç†å®Œæˆ (30ç§’)
# 4. æ£€æŸ¥æ•°æ®åº“çŠ¶æ€
# 5. ç”Ÿæˆæœ¬åœ°æ•°æ®æ–‡ä»¶
```

#### âœ… åŒ—äº¬Caseæ•°æ®èŒƒå›´
**åœ°ç†èŒƒå›´**: åŒ—äº¬æ ¸å¿ƒåŒºåŸŸ
- **ä¸­å¿ƒåæ ‡**: 39.9042Â°N, 116.4074Â°E
- **è¦†ç›–åŠå¾„**: 5ç“¦ç‰‡ (çº¦7x7åŒºåŸŸ)
- **ç¼©æ”¾çº§åˆ«**: 15-16çº§ (è¡—åŒºçº§ç²¾åº¦)
- **é¢„è®¡ç“¦ç‰‡æ•°**: 49ä¸ªç“¦ç‰‡
- **é¢„è®¡å»ºç­‘ç‰©**: 1000-5000ä¸ª

#### âœ… ä¸šåŠ¡è·‘é€šéªŒè¯æ­¥éª¤
**æ­¥éª¤1: æ•°æ®é¢„å¤„ç†**
```bash
cd shadow-map-backend
node preload-beijing.js
```

**æ­¥éª¤2: å‰ç«¯éªŒè¯**
```bash
cd shadow-map-frontend/react-shadow-app
npm run dev
# è®¿é—® http://localhost:5173
# å¯¼èˆªåˆ°åŒ—äº¬åœ°åŒºæµ‹è¯•é˜´å½±æ•ˆæœ
```

**æ­¥éª¤3: æ€§èƒ½éªŒè¯**
- âœ… æ§åˆ¶å°ç®€æ´ï¼Œæ— ç½‘ç»œè¯·æ±‚æ—¥å¿—
- âœ… å»ºç­‘ç‰©åŠ è½½è¿…é€Ÿ (<100ms)
- âœ… é˜´å½±è®¡ç®—æµç•…ï¼Œæ— å¡é¡¿
- âœ… åœ°å›¾æ‹–æ‹½å“åº”åŠæ—¶

#### âœ… é¢„æœŸæ•ˆæœå¯¹æ¯”

| æŒ‡æ ‡ | ä¿®å¤å‰ | ä¿®å¤å |
|------|--------|--------|
| **æ•°æ®åº“è¿æ¥** | TypeErrorå¤±è´¥ | âœ… æ­£å¸¸è¿æ¥ |
| **åŒ—äº¬æ•°æ®è¦†ç›–** | 0ä¸ªå»ºç­‘ç‰© | 1000-5000ä¸ªå»ºç­‘ç‰© |
| **å“åº”æ—¶é—´** | 53ç§’/å»ºç­‘ç‰© | <100ms/åŒºåŸŸ |
| **æ§åˆ¶å°æ—¥å¿—** | å¤§é‡ç½‘ç»œè¯·æ±‚ | ç®€æ´æœ¬åœ°æ•°æ® |
| **ç”¨æˆ·ä½“éªŒ** | ç»å¸¸å¤±è´¥ | æµç•…é˜´å½±æ•ˆæœ |

**æ ¸å¿ƒç›®æ ‡**: ä»¥åŒ—äº¬ä¸ºè¯•ç‚¹ï¼ŒéªŒè¯å®Œæ•´çš„æœ¬åœ°æ•°æ®ä¼˜å…ˆç­–ç•¥ï¼Œç¡®ä¿ä¸šåŠ¡èƒ½è·‘é€š

---

è¿™ä¸ªæ›´æ–°åçš„æ–‡æ¡£æ¸…æ™°åœ°ä½“ç°äº†é¡¹ç›®ä»åŸºç¡€é˜´å½±æ¨¡æ‹Ÿåˆ°æ™ºèƒ½å‡ºè¡Œè§„åˆ’çš„å‡çº§è·¯å¾„ï¼Œä¸ºåç»­å¼€å‘æä¾›äº†æ˜ç¡®çš„æŠ€æœ¯è·¯çº¿å›¾ã€‚