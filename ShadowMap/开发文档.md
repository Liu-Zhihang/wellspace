# ShadowMap æ™ºèƒ½å‡ºè¡Œé˜´å½±è§„åˆ’ç³»ç»Ÿ - å¼€å‘æ–‡æ¡£

## ğŸ¯ é¡¹ç›®æ„¿æ™¯ä¸ç›®æ ‡

### æ ¸å¿ƒç†å¿µ
åŸºäº [shademap.app](https://shademap.app/terms/) çš„é˜´å½±æ¨¡æ‹ŸæŠ€æœ¯ï¼Œæ‰“é€ **æ™ºèƒ½å‡ºè¡Œè§„åˆ’ç³»ç»Ÿ**ï¼Œä¸ºç”¨æˆ·æä¾›åŸºäºé˜´å½±å’Œå¤©æ°”æ•°æ®çš„å‡ºè¡Œå»ºè®®ã€‚

### äº§å“å·®å¼‚åŒ–å®šä½
- **åŸºç¡€åŠŸèƒ½**ï¼šå¤ç°shademap.appçš„å…¨çƒé˜´å½±æ¨¡æ‹Ÿèƒ½åŠ›
- **æ ¸å¿ƒåˆ›æ–°**ï¼šé¢å‘å‡ºè¡Œåœºæ™¯çš„æ™ºèƒ½è§„åˆ’åŠŸèƒ½
  - ğŸš¶â€â™‚ï¸ **æœ€å°‘é˜³å…‰è·¯å¾„è§„åˆ’** - ä¸ºç”¨æˆ·è§„åˆ’æ™’å¤ªé˜³æœ€å°‘çš„å‡ºè¡Œè·¯çº¿
  - ğŸ“Š **å…‰ç…§æ—¶é—´åºåˆ—åˆ†æ** - åˆ†æGPSè½¨è¿¹çš„å®Œæ•´å…‰ç…§æš´éœ²æƒ…å†µ
  - ğŸŒ¤ï¸ **å¤©æ°”æ•°æ®èåˆ** - ç»“åˆäº‘å±‚ã€UVæŒ‡æ•°ç­‰å®æ—¶å¤©æ°”æ•°æ®
  - ğŸ“ˆ **ä¸€æ—¥å…‰ç…§ç»Ÿè®¡** - ç±»ä¼¼å¥åº·åº”ç”¨çš„æ­¥æ•°ç»Ÿè®¡åŠŸèƒ½

## ğŸ“‹ æŠ€æœ¯æ ˆæ¶æ„

### å‰ç«¯æŠ€æœ¯æ ˆ
- **æ¡†æ¶**: React 19 + TypeScript + Vite
- **åœ°å›¾**: Leaflet + leaflet-shadow-simulator (é˜´å½±è®¡ç®—å¼•æ“)
- **çŠ¶æ€ç®¡ç†**: Zustand
- **æ ·å¼**: Tailwind CSS
- **æ•°æ®è·å–**: è‡ªå»ºAPIæœåŠ¡

### åç«¯æŠ€æœ¯æ ˆ
- **æœåŠ¡å™¨**: Node.js + Express + TypeScript
- **æ•°æ®åº“**: MongoDB (åœ°ç†æ•°æ®ã€ç”¨æˆ·è½¨è¿¹ã€ç¼“å­˜)
- **åœ°ç†æ•°æ®**: è‡ªå»ºDEMç“¦ç‰‡æœåŠ¡ + OSMå»ºç­‘ç‰©æ•°æ®
- **å¤©æ°”æ•°æ®**: é›†æˆ [earth.nullschool.net](https://earth.nullschool.net) API

### æ•°æ®æºç­–ç•¥
- **DEMåœ°å½¢æ•°æ®**: AWS Terrariumæ ¼å¼ï¼Œæ”¯æŒå…¨çƒè¦†ç›–
- **å»ºç­‘ç‰©æ•°æ®**: OSM Overpass API + æ™ºèƒ½ç¼“å­˜ç­–ç•¥
- **å¤©æ°”æ•°æ®**: nullschool.net (UVæŒ‡æ•°ã€äº‘å±‚è¦†ç›–ã€æ¸©åº¦ç­‰)

## ğŸš€ å¼€å‘é˜¶æ®µè§„åˆ’

### âœ… ç¬¬ä¸€é˜¶æ®µï¼šåŸºç¡€æ¶æ„ (å·²å®Œæˆ)
- [x] å‰åç«¯åˆ†ç¦»æ¶æ„æ­å»º
- [x] React + TypeScript + Leaflet é›†æˆ
- [x] Express APIæœåŠ¡å™¨
- [x] leaflet-shadow-simulator æ’ä»¶é›†æˆ
- [x] DEMç“¦ç‰‡æœåŠ¡ (æ”¯æŒåŒ—äº¬åœ°åŒºçœŸå®æ•°æ®)
- [x] OSMå»ºç­‘ç‰©APIé›†æˆ
- [x] å¤šåº•å›¾æ”¯æŒç³»ç»Ÿ

### ğŸ”„ ç¬¬äºŒé˜¶æ®µï¼šæ ¸å¿ƒåŠŸèƒ½å®Œå–„ (è¿›è¡Œä¸­)
- [x] å»ºç­‘ç‰©é«˜åº¦ä¸é˜´å½±è®¡ç®—è”åŠ¨
- [x] æ—¶é—´æ§åˆ¶å’ŒåŠ¨ç”»ç³»ç»Ÿ
- [x] ç‚¹å‡»åˆ†æåŠŸèƒ½
- [x] é«˜çº§ç¼“å­˜ç®¡ç†ç³»ç»Ÿ
- [ ] **MongoDBæ•°æ®åº“é›†æˆ** (æ›¿æ¢æ–‡ä»¶ç¼“å­˜)
- [ ] **OSM APIé€Ÿç‡é™åˆ¶ä¼˜åŒ–** (é¢„å¤„ç†çƒ­é—¨åŸå¸‚æ•°æ®)

### ğŸ¯ ç¬¬ä¸‰é˜¶æ®µï¼šå‡ºè¡Œè§„åˆ’åŠŸèƒ½ (æ ¸å¿ƒåˆ›æ–°)

#### 3.1 è·¯å¾„è§„åˆ’ç®—æ³•
```typescript
// æœ€å°‘é˜³å…‰è·¯å¾„ä¼˜åŒ–
class ShadowRouteOptimizer {
  async findMinSunRoute(start: LatLng, end: LatLng, time: Date) {
    // 1. è·å–å¤šæ¡å¯é€‰è·¯å¾„
    const routes = await this.getAllPossibleRoutes(start, end);
    
    // 2. åˆ†ææ¯æ¡è·¯å¾„çš„é˜´å½±æš´éœ²
    const analyzed = await Promise.all(
      routes.map(route => this.analyzeSunExposure(route, time))
    );
    
    // 3. ç»¼åˆè¯„åˆ†ï¼šé˜´å½±è¦†ç›–ç‡ + è·¯å¾„é•¿åº¦ + èˆ’é€‚åº¦
    return this.rankRoutesByComfort(analyzed);
  }
  
  private async analyzeSunExposure(route: Route, time: Date) {
    const segments = this.divideRouteIntoSegments(route);
    let totalSunExposure = 0;
    
    for (const segment of segments) {
      const shadowData = await this.calculateShadowForSegment(segment, time);
      const weatherData = await this.getWeatherData(segment.center, time);
      
      // è€ƒè™‘äº‘å±‚é®æŒ¡æ•ˆæœ
      const effectiveSun = shadowData.sunlight * (1 - weatherData.cloudCover * 0.8);
      const uvExposure = effectiveSun * weatherData.uvIndex;
      
      totalSunExposure += uvExposure * segment.duration;
    }
    
    return {
      route,
      totalSunExposure,
      comfort: this.calculateComfort(totalSunExposure),
      estimatedTime: route.duration
    };
  }
}
```

#### 3.2 GPSè½¨è¿¹åˆ†æ
```typescript
// å…‰ç…§æ—¶é—´åºåˆ—åˆ†æ
class TrajectoryAnalyzer {
  async analyzeLightExposure(gpsTrack: GPSPoint[]) {
    const timeSeriesData: LightExposurePoint[] = [];
    
    for (let i = 0; i < gpsTrack.length - 1; i++) {
      const segment = {
        start: gpsTrack[i],
        end: gpsTrack[i + 1],
        duration: gpsTrack[i + 1].timestamp - gpsTrack[i].timestamp
      };
      
      // è·å–é˜´å½±æ•°æ®
      const shadowData = await this.calculateShadowForSegment(segment);
      
      // è·å–å¤©æ°”æ•°æ®
      const weatherData = await this.getWeatherData(segment.start, segment.start.timestamp);
      
      timeSeriesData.push({
        time: gpsTrack[i].timestamp,
        location: gpsTrack[i],
        sunlightRatio: shadowData.sunlightRatio,
        uvExposure: shadowData.uvExposure * weatherData.uvIndex,
        comfort: this.calculateComfort(weatherData),
        cloudCover: weatherData.cloudCover
      });
    }
    
    return this.generateDailyReport(timeSeriesData);
  }
  
  private generateDailyReport(data: LightExposurePoint[]) {
    return {
      totalSunlightMinutes: data.reduce((sum, point) => sum + point.sunlightRatio * point.duration, 0),
      totalUVExposure: data.reduce((sum, point) => sum + point.uvExposure, 0),
      averageComfort: data.reduce((sum, point) => sum + point.comfort, 0) / data.length,
      peakExposureTime: data.reduce((max, point) => point.uvExposure > max.uvExposure ? point : max),
      recommendations: this.generateRecommendations(data)
    };
  }
}
```

#### 3.3 å¤©æ°”æ•°æ®é›†æˆ
```typescript
// å¤©æ°”æ•°æ®å¢å¼ºé˜´å½±è®¡ç®—
class WeatherEnhancedShadowCalculator {
  async calculateWithWeather(location: LatLng, time: Date) {
    // 1. åŸºç¡€é˜´å½±è®¡ç®—
    const baseShadow = await this.calculateBaseShadow(location, time);
    
    // 2. è·å–å®æ—¶å¤©æ°”æ•°æ®
    const weather = await this.fetchWeatherData(location, time);
    
    // 3. äº‘å±‚ä¿®æ­£
    const cloudCover = weather.cloudCover; // 0-1
    const effectiveSunlight = baseShadow.sunlight * (1 - cloudCover * 0.8);
    
    // 4. UVæŒ‡æ•°ä¿®æ­£
    const uvIndex = weather.uvIndex;
    const uvExposure = effectiveSunlight * uvIndex;
    
    return {
      ...baseShadow,
      effectiveSunlight,
      uvExposure,
      comfort: this.calculateComfort(weather),
      recommendations: this.generateRecommendations(weather, baseShadow)
    };
  }
  
  private async fetchWeatherData(location: LatLng, time: Date) {
    // é›†æˆ nullschool.net API
    const response = await fetch(`/api/weather?lat=${location.lat}&lng=${location.lng}&time=${time.toISOString()}`);
    return response.json();
  }
}
```

### ğŸ¨ ç¬¬å››é˜¶æ®µï¼šç”¨æˆ·ä½“éªŒä¼˜åŒ–

#### 4.1 æ™ºèƒ½æ¨èç³»ç»Ÿ
- **æœ€ä½³å‡ºè¡Œæ—¶é—´æ¨è**: åŸºäºå¤©æ°”é¢„æŠ¥å’Œé˜´å½±é¢„æµ‹
- **å®æ—¶è·¯å¾„è°ƒæ•´**: æ ¹æ®äº‘å±‚å˜åŒ–åŠ¨æ€è°ƒæ•´è·¯çº¿
- **ä¸ªæ€§åŒ–è®¾ç½®**: ç”¨æˆ·å¯è®¾ç½®å¯¹é˜³å…‰çš„æ•æ„Ÿåº¦

#### 4.2 å¯è§†åŒ–å¢å¼º
- **å®æ—¶è·¯å¾„å»ºè®®**: ç±»ä¼¼å¯¼èˆªï¼Œä½†ä¼˜åŒ–ç›®æ ‡æ˜¯èˆ’é€‚åº¦
- **ä¸€æ—¥å…‰ç…§æŠ¥å‘Š**: ç±»ä¼¼å¥åº·åº”ç”¨çš„æ´»åŠ¨ç»Ÿè®¡
- **é˜´å½±è½¨è¿¹å¯è§†åŒ–**: æ˜¾ç¤ºå¤ªé˜³è·¯å¾„å’Œé˜´å½±å˜åŒ–

## ğŸ’¾ MongoDBæ•°æ®åº“è®¾è®¡

### é›†åˆç»“æ„è®¾è®¡
```javascript
// å»ºç­‘ç‰©æ•°æ®é›†åˆ
db.buildings.createIndex({ "geometry": "2dsphere" }); // åœ°ç†ç©ºé—´ç´¢å¼•
{
  _id: ObjectId,
  geometry: {
    type: "Polygon",
    coordinates: [[[lng, lat], ...]]
  },
  properties: {
    height: 25.5,
    levels: 8,
    building_type: "residential"
  },
  tile: { z: 15, x: 26976, y: 13487 }, // ç“¦ç‰‡ç´¢å¼•
  last_updated: ISODate
}

// ç”¨æˆ·å‡ºè¡Œè½¨è¿¹é›†åˆ
db.user_tracks.createIndex({ "route.geometry": "2dsphere" });
{
  _id: ObjectId,
  user_id: "user123",
  route: {
    type: "LineString",
    coordinates: [[lng, lat, timestamp], ...]
  },
  analysis: {
    total_sunlight_minutes: 45,
    total_uv_exposure: 2.3,
    comfort_score: 7.5,
    shadow_segments: [...]
  },
  created_at: ISODate
}

// DEMç“¦ç‰‡å…ƒæ•°æ®é›†åˆ
db.dem_tiles.createIndex({ "z": 1, "x": 1, "y": 1 });
{
  _id: "15/26976/13487",
  z: 15, x: 26976, y: 13487,
  bounds: [lng1, lat1, lng2, lat2],
  file_path: "/data/dem/15/26976/13487.png",
  cached: true,
  created_at: ISODate
}
```

### æ•°æ®åˆ†ç‰‡ç­–ç•¥
- **åœ°ç†åˆ†ç‰‡**: æŒ‰ç»çº¬åº¦èŒƒå›´åˆ†ç‰‡ï¼Œæ”¯æŒå…¨çƒæ•°æ®åˆ†å¸ƒ
- **æ—¶é—´åˆ†ç‰‡**: ç”¨æˆ·è½¨è¿¹æŒ‰æ—¶é—´åˆ†ç‰‡ï¼Œä¼˜åŒ–æŸ¥è¯¢æ€§èƒ½

## ğŸŒ APIæ¥å£è®¾è®¡

### æ ¸å¿ƒAPIç«¯ç‚¹
```typescript
// é˜´å½±è®¡ç®—ç›¸å…³
POST /api/shadow/calculate         // è®¡ç®—æŒ‡å®šåŒºåŸŸé˜´å½±
GET  /api/shadow/realtime         // å®æ—¶é˜´å½±æ•°æ®
POST /api/shadow/analyze-route    // åˆ†æè·¯å¾„é˜´å½±æš´éœ²

// å‡ºè¡Œè§„åˆ’ç›¸å…³ (æ–°å¢)
POST /api/routes/optimize         // æœ€å°‘é˜³å…‰è·¯å¾„è§„åˆ’
POST /api/routes/analyze          // GPSè½¨è¿¹åˆ†æ
GET  /api/routes/recommendations  // è·å–å‡ºè¡Œå»ºè®®

// å¤©æ°”æ•°æ®ç›¸å…³ (æ–°å¢)
GET  /api/weather/current         // å½“å‰å¤©æ°”æ•°æ®
GET  /api/weather/forecast        // å¤©æ°”é¢„æŠ¥
GET  /api/weather/uv-index        // UVæŒ‡æ•°æŸ¥è¯¢

// åœ°ç†æ•°æ®ç›¸å…³
GET  /api/dem/:z/:x/:y.png        // DEMç“¦ç‰‡
GET  /api/buildings/:z/:x/:y.json // å»ºç­‘ç‰©æ•°æ®
GET  /api/terrain/elevation       // é«˜ç¨‹æŸ¥è¯¢

// ç”¨æˆ·æ•°æ®ç›¸å…³ (æ–°å¢)
POST /api/users/tracks            // ä¿å­˜ç”¨æˆ·è½¨è¿¹
GET  /api/users/tracks/:id        // è·å–è½¨è¿¹åˆ†æ
GET  /api/users/stats            // ç”¨æˆ·å…‰ç…§ç»Ÿè®¡
```

## ğŸ”§ æŠ€æœ¯æŒ‘æˆ˜ä¸è§£å†³æ–¹æ¡ˆ

### 1. OSM APIé€Ÿç‡é™åˆ¶é—®é¢˜
**é—®é¢˜**: Overpass APIé™åˆ¶æ¯åˆ†é’Ÿ60ä¸ªè¯·æ±‚
**è§£å†³æ–¹æ¡ˆ**:
- **æ•°æ®é¢„å¤„ç†**: é¢„ä¸‹è½½çƒ­é—¨åŸå¸‚å»ºç­‘ç‰©æ•°æ®åˆ°MongoDB
- **æ™ºèƒ½ç¼“å­˜**: å®ç°å¤šçº§ç¼“å­˜(å†…å­˜ + æ•°æ®åº“ + æ–‡ä»¶)
- **è¯·æ±‚é˜Ÿåˆ—**: å®ç°é€Ÿç‡æ§åˆ¶å’Œè¯·æ±‚å»é‡

### 2. å¤§è§„æ¨¡åœ°ç†æ•°æ®å¤„ç†
**é—®é¢˜**: å…¨çƒDEMå’Œå»ºç­‘ç‰©æ•°æ®é‡å·¨å¤§
**è§£å†³æ–¹æ¡ˆ**:
- **åˆ†çº§æ•°æ®ç­–ç•¥**: æ ¸å¿ƒåŸå¸‚é¢„å­˜å‚¨ï¼Œå…¶ä»–åœ°åŒºAPIè°ƒç”¨
- **æ•°æ®å‹ç¼©**: ä½¿ç”¨é«˜æ•ˆçš„åœ°ç†æ•°æ®å‹ç¼©ç®—æ³•
- **è¾¹ç¼˜ç¼“å­˜**: CDNç¼“å­˜é™æ€ç“¦ç‰‡æ•°æ®

### 3. å®æ—¶å¤©æ°”æ•°æ®é›†æˆ
**é—®é¢˜**: éœ€è¦é›†æˆå¤šä¸ªå¤©æ°”æ•°æ®æº
**è§£å†³æ–¹æ¡ˆ**:
- **ç»Ÿä¸€å¤©æ°”API**: å°è£…nullschool.netç­‰å¤šä¸ªæ•°æ®æº
- **æ•°æ®ç¼“å­˜**: å¤©æ°”æ•°æ®æŒ‰æ—¶é—´å’Œä½ç½®ç¼“å­˜
- **é™çº§ç­–ç•¥**: æ•°æ®æºå¤±æ•ˆæ—¶çš„å¤‡ç”¨æ–¹æ¡ˆ

## ğŸ“Š å½“å‰å¼€å‘çŠ¶æ€

### âœ… å·²å®ŒæˆåŠŸèƒ½
- [x] åŸºç¡€é˜´å½±æ¨¡æ‹Ÿç³»ç»Ÿ (React + leaflet-shadow-simulator)
- [x] DEMåœ°å½¢æ•°æ®é›†æˆ (AWS Terrariumæ ¼å¼)
- [x] OSMå»ºç­‘ç‰©æ•°æ®API (Overpass APIé›†æˆ)
- [x] å¤šåº•å›¾æ”¯æŒ (OSMã€CartoDBã€ESRIã€Mapboxç­‰)
- [x] æ—¶é—´æ§åˆ¶å’ŒåŠ¨ç”»ç³»ç»Ÿ
- [x] ç‚¹å‡»åˆ†æåŠŸèƒ½ (æ—¥ç…§æ—¶é•¿è®¡ç®—)
- [x] é«˜çº§ç¼“å­˜ç®¡ç†ç³»ç»Ÿ
- [x] ç°ä»£åŒ–UIè®¾è®¡ (Tailwind CSS)

### ğŸ”„ è¿›è¡Œä¸­ä»»åŠ¡
- [x] **MongoDBæ•°æ®åº“é›†æˆ** (âœ… å·²è§£å†³è¿æ¥é—®é¢˜)
- [ ] å¤©æ°”æ•°æ®APIé›†æˆ (nullschool.net)
- [ ] è·¯å¾„è§„åˆ’ç®—æ³•å®ç°
- [ ] GPSè½¨è¿¹åˆ†æåŠŸèƒ½

### ğŸ“ ä¸‹ä¸€é˜¶æ®µè®¡åˆ’ (ä¼˜å…ˆçº§æ’åº)

#### é«˜ä¼˜å…ˆçº§ (1-2å‘¨)
1. **MongoDBé›†æˆ**: æ›¿æ¢ç°æœ‰æ–‡ä»¶ç¼“å­˜ï¼Œæå‡æ•°æ®æŸ¥è¯¢æ€§èƒ½
2. **OSMæ•°æ®é¢„å¤„ç†**: é¢„ä¸‹è½½çƒ­é—¨åŸå¸‚æ•°æ®ï¼Œå‡å°‘APIä¾èµ–
3. **å¤©æ°”æ•°æ®é›†æˆ**: å®ç°nullschool.net APIé›†æˆ

#### ä¸­ä¼˜å…ˆçº§ (2-4å‘¨)
4. **è·¯å¾„è§„åˆ’ç®—æ³•**: å®ç°æœ€å°‘é˜³å…‰è·¯å¾„è®¡ç®—
5. **GPSè½¨è¿¹åˆ†æ**: å®ç°å…‰ç…§æ—¶é—´åºåˆ—åˆ†æ
6. **ç”¨æˆ·ç³»ç»Ÿ**: å®ç°è½¨è¿¹ä¿å­˜å’Œç»Ÿè®¡åŠŸèƒ½

#### ä½ä¼˜å…ˆçº§ (1-2ä¸ªæœˆ)
7. **æ€§èƒ½ä¼˜åŒ–**: WebGLæ¸²æŸ“ã€æ•°æ®å‹ç¼©ç­‰
8. **ç§»åŠ¨ç«¯é€‚é…**: å“åº”å¼è®¾è®¡å’ŒPWAæ”¯æŒ
9. **ç”Ÿäº§éƒ¨ç½²**: Dockerå®¹å™¨åŒ–å’ŒCI/CDæµæ°´çº¿

### ğŸ”„ æ›¿è¡¥éœ€æ±‚ (æœªæ¥è€ƒè™‘)
10. **è‡ªç ”é˜´å½±è®¡ç®—å¼•æ“**: æ›¿æ¢leaflet-shadow-simulatorï¼Œå®ç°å®Œå…¨è‡ªä¸»çš„é˜´å½±è®¡ç®—
    - è‡ªç ”å¤ªé˜³ä½ç½®ç®—æ³•
    - è‡ªç ”å…‰çº¿è¿½è¸ªç®—æ³•  
    - è‡ªå®šä¹‰GPUç€è‰²å™¨ç¨‹åº
    - é’ˆå¯¹å‡ºè¡Œåœºæ™¯çš„æ€§èƒ½ä¼˜åŒ–

## ğŸ¯ å•†ä¸šåŒ–è€ƒè™‘

### ç›®æ ‡ç”¨æˆ·ç¾¤ä½“
- **ä¸ªäººç”¨æˆ·**: æ³¨é‡é˜²æ™’å’Œèˆ’é€‚å‡ºè¡Œçš„ç”¨æˆ·
- **å¥åº·åº”ç”¨å¼€å‘å•†**: éœ€è¦å…‰ç…§æ•°æ®çš„åº”ç”¨é›†æˆ
- **åŸå¸‚è§„åˆ’å¸ˆ**: éœ€è¦é˜´å½±åˆ†æçš„ä¸“ä¸šç”¨æˆ·
- **å»ºç­‘è®¾è®¡å¸ˆ**: éœ€è¦é‡‡å…‰åˆ†æçš„è®¾è®¡å¸ˆ

### å•†ä¸šæ¨¡å¼
- **APIè°ƒç”¨æ”¶è´¹**: æŒ‰è¯·æ±‚é‡è®¡è´¹çš„APIæœåŠ¡
- **SaaSè®¢é˜…**: é¢å‘ä¼ä¸šç”¨æˆ·çš„è®¢é˜…æœåŠ¡
- **æ•°æ®æˆæƒ**: å‘å…¶ä»–åº”ç”¨æä¾›åœ°ç†å’Œé˜´å½±æ•°æ®

### ç«äº‰ä¼˜åŠ¿
- **è‡ªä¸»æŠ€æœ¯æ ˆ**: å®Œå…¨åŸºäºè‡ªæœ‰æœåŠ¡å™¨ï¼Œä¸ä¾èµ–ç¬¬ä¸‰æ–¹
- **å‡ºè¡Œåœºæ™¯ä¼˜åŒ–**: é’ˆå¯¹å®é™…å‡ºè¡Œéœ€æ±‚çš„åŠŸèƒ½åˆ›æ–°
- **å…¨çƒæ•°æ®è¦†ç›–**: æ”¯æŒå…¨çƒä»»æ„ä½ç½®çš„é˜´å½±åˆ†æ
- **å®æ—¶å¤©æ°”é›†æˆ**: ç»“åˆå¤©æ°”æ•°æ®çš„æ™ºèƒ½æ¨è

---

## ğŸ“š æŠ€æœ¯æ¶æ„æ€»ç»“

### ç³»ç»Ÿæ¶æ„å›¾
```
ç”¨æˆ·ç•Œé¢ (React + Leaflet)
    â†“
çŠ¶æ€ç®¡ç† (Zustand Store)
    â†“
APIæœåŠ¡å±‚ (è‡ªå»ºExpress API)
    â†“
æ•°æ®å­˜å‚¨å±‚ (MongoDB + æ–‡ä»¶ç¼“å­˜)
    â†“
å¤–éƒ¨æ•°æ®æº (AWS DEM + OSM + Weather APIs)
```

### å…³é”®æŠ€æœ¯å†³ç­–
1. **å‰ç«¯**: Reactç”Ÿæ€ç³»ç»Ÿï¼Œç°ä»£åŒ–å¼€å‘ä½“éªŒ
2. **åœ°å›¾**: Leaflet + leaflet-shadow-simulatorï¼Œæˆç†Ÿçš„é˜´å½±è®¡ç®—æ–¹æ¡ˆ
3. **æ•°æ®æº**: å®Œå…¨è‡ªä¸»çš„DEMå’Œå»ºç­‘ç‰©æ•°æ®ï¼Œæ‘†è„±ç¬¬ä¸‰æ–¹ä¾èµ–
4. **æ•°æ®åº“**: MongoDBï¼ŒåŸç”Ÿæ”¯æŒåœ°ç†ç©ºé—´æ•°æ®
5. **ç¼“å­˜**: å¤šçº§ç¼“å­˜ç­–ç•¥ï¼Œå¹³è¡¡æ€§èƒ½å’Œæˆæœ¬
6. **éƒ¨ç½²**: Dockerå®¹å™¨åŒ–ï¼Œæ”¯æŒæ°´å¹³æ‰©å±•

### ğŸ”§ å½“å‰æŠ€æœ¯æ¶æ„è¯´æ˜
- **é˜´å½±è®¡ç®—**: ä½¿ç”¨leaflet-shadow-simulatorä½œä¸ºè®¡ç®—å¼•æ“ï¼Œä½†æ•°æ®å®Œå…¨æ¥è‡ªè‡ªå»ºæœåŠ¡
- **æ•°æ®ç‹¬ç«‹æ€§**: DEMç“¦ç‰‡å’Œå»ºç­‘ç‰©æ•°æ®å‡é€šè¿‡è‡ªå»ºAPIæä¾›
- **è®¡ç®—é€»è¾‘**: åŸºäºç‰©ç†å…‰çº¿è¿½è¸ªç®—æ³•ï¼Œæ”¯æŒçœŸå®çš„é˜´å½±æ¨¡æ‹Ÿ
- **æ‰©å±•æ€§**: ä¸ºæœªæ¥æ›¿æ¢ä¸ºè‡ªç ”å¼•æ“é¢„ç•™äº†æ¶æ„ç©ºé—´

---

## ğŸ› æŠ€æœ¯é—®é¢˜è§£å†³è®°å½•

### MongoDB Atlasè¿æ¥é—®é¢˜ (2025-01-XX)

#### é—®é¢˜æè¿°
- **ç—‡çŠ¶**: MongoDB Atlasè¿æ¥è¶…æ—¶ï¼ŒDNSè§£æå¤±è´¥
- **é”™è¯¯**: `queryTxt ETIMEOUT cluster0.1qxqrnr.mongodb.net`
- **å½±å“**: æ— æ³•å¯åŠ¨MongoDBé›†æˆåŠŸèƒ½

#### æ ¹æœ¬åŸå› 
**Windowsç³»ç»ŸDNSé…ç½®é—®é¢˜**ï¼š
- ç³»ç»Ÿé»˜è®¤ä½¿ç”¨è·¯ç”±å™¨DNS (192.168.1.1)
- è·¯ç”±å™¨DNSæ— æ³•æ­£ç¡®è§£æMongoDB AtlasåŸŸå
- å¯¼è‡´æ‰€æœ‰MongoDBè¿æ¥å·¥å…·å¤±è´¥ï¼ˆä»£ç ã€Compassç­‰ï¼‰

#### è§£å†³æ–¹æ¡ˆ
**åˆ‡æ¢åˆ°Google DNSæœåŠ¡å™¨**ï¼š
```bash
# 1. ä»¥ç®¡ç†å‘˜èº«ä»½è¿è¡ŒPowerShell
# 2. è®¾ç½®WLANæ¥å£ä½¿ç”¨Google DNS
netsh interface ip set dns "WLAN" static 8.8.8.8
netsh interface ip add dns "WLAN" 8.8.4.4 index=2

# 3. éªŒè¯è®¾ç½®
netsh interface ip show dns "WLAN"

# 4. åˆ·æ–°DNSç¼“å­˜
ipconfig /flushdns
```

#### éªŒè¯ç»“æœ
```bash
# DNSè§£ææˆåŠŸ
nslookup cluster0.1qxqrnr.mongodb.net 8.8.8.8
# è¾“å‡º: æœåŠ¡å™¨: dns.google, åç§°: cluster0.1qxqrnr.mongodb.net

# MongoDBè¿æ¥æˆåŠŸ
node src/config/db.js
# è¾“å‡º: MONGODB CONNECTED SUCCESSFULLY!
```

#### ç»éªŒæ•™è®­
1. **ç½‘ç»œç¯å¢ƒè¯Šæ–­**ï¼šMongoDBè¿æ¥é—®é¢˜é¦–å…ˆæ£€æŸ¥DNSè§£æ
2. **å·¥å…·å¯¹æ¯”éªŒè¯**ï¼šåŒæ—¶ç”¨ä»£ç å’ŒGUIå·¥å…·(Compass)éªŒè¯é—®é¢˜
3. **ç³»ç»Ÿçº§é…ç½®**ï¼šæŸäº›é—®é¢˜éœ€è¦ä¿®æ”¹ç³»ç»Ÿç½‘ç»œé…ç½®
4. **DNSæœåŠ¡å™¨é€‰æ‹©**ï¼šGoogle DNS (8.8.8.8) æ¯”è·¯ç”±å™¨DNSæ›´ç¨³å®š

#### é¢„é˜²æªæ–½
- å¼€å‘ç¯å¢ƒå»ºè®®ç»Ÿä¸€ä½¿ç”¨Google DNS
- æ–‡æ¡£è®°å½•ç½‘ç»œé…ç½®è¦æ±‚
- æä¾›ç½‘ç»œé—®é¢˜æ’æŸ¥æ¸…å•

---

è¿™ä¸ªæ›´æ–°åçš„æ–‡æ¡£æ¸…æ™°åœ°ä½“ç°äº†é¡¹ç›®ä»åŸºç¡€é˜´å½±æ¨¡æ‹Ÿåˆ°æ™ºèƒ½å‡ºè¡Œè§„åˆ’çš„å‡çº§è·¯å¾„ï¼Œä¸ºåç»­å¼€å‘æä¾›äº†æ˜ç¡®çš„æŠ€æœ¯è·¯çº¿å›¾ã€‚